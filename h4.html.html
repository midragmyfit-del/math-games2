<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¦×™×“ ×’'×•×§×™× - ×›×™×ª×•×ª ×’'-×“'</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        .menu-container {
            background: white;
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 3em;
            color: #56ab2f;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 40px;
        }

        .mode-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-btn {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
            border: none;
            padding: 25px 40px;
            font-size: 1.3em;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(86, 171, 47, 0.4);
        }

        .mode-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(86, 171, 47, 0.6);
        }

        .difficulty-selector {
            margin-top: 30px;
        }

        .difficulty-selector h3 {
            color: #56ab2f;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .difficulty-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: 3px solid #56ab2f;
            background: white;
            color: #56ab2f;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .difficulty-btn:hover {
            background: #56ab2f;
            color: white;
            transform: scale(1.05);
        }

        .difficulty-btn.active {
            background: #56ab2f;
            color: white;
        }

        .game-container {
            display: none;
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1400px;
            width: 100%;
            max-height: 95vh;
            overflow-y: auto;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 3px solid #56ab2f;
        }

        .back-button {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: scale(1.05);
        }

        .round-info {
            font-size: 1.8em;
            color: #56ab2f;
            font-weight: bold;
        }

        .players-display {
            display: none;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 20px;
        }

        .players-display.active {
            display: flex;
        }

        .player-card {
            flex: 1;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .player-card.active-player {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(86, 171, 47, 0.4);
            border: 3px solid #56ab2f;
        }

        .player-card.player1 {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .player-card.player2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .player-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .player-score {
            font-size: 2.5em;
            font-weight: bold;
        }

        .turn-indicator {
            font-size: 1.2em;
            margin-top: 10px;
            opacity: 0;
        }

        .player-card.active-player .turn-indicator {
            opacity: 1;
        }

        .question-section {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 3.5em;
            color: #d35400;
            font-weight: bold;
            margin-bottom: 30px;
            direction: ltr;
        }

        .answer-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .answer-btn {
            background: white;
            color: #56ab2f;
            border: 4px solid #56ab2f;
            padding: 25px 50px;
            font-size: 2em;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .answer-btn:hover {
            background: #56ab2f;
            color: white;
            transform: scale(1.1);
        }

        .bug-arena {
            display: none;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 20px;
            padding: 20px;
            min-height: 600px;
            position: relative;
            overflow: hidden;
            border: 5px dashed #56ab2f;
        }

        .arena-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .arena-header div {
            font-size: 1.5em;
            font-weight: bold;
            color: #56ab2f;
        }

        .timer-bar {
            background: rgba(86, 171, 47, 0.2);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
        }

        .timer-fill {
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            height: 100%;
            width: 100%;
            transition: width 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2em;
        }

        .game-area {
            position: relative;
            height: 500px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><text y="56" font-size="56">ğŸ•·ï¸</text></svg>') 32 32, auto;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><rect width="20" height="20" fill="%23ffffff" opacity="0.3"/></svg>') repeat;
        }

        .bug {
            position: absolute;
            width: 60px;
            height: 90px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><text y="56" font-size="56">ğŸ•·ï¸</text></svg>') 32 32, pointer;
            user-select: none;
            transition: transform 0.1s ease;
            filter: drop-shadow(3px 3px 8px rgba(0,0,0,0.6));
        }

        /* ×’×•×£ ×”×’'×•×§ - ×—×•× ×›×”×” ××‘×¨×™×§ */
        .bug::before {
            content: '';
            position: absolute;
            width: 70%;
            height: 85%;
            background: linear-gradient(180deg, 
                #1a0f0a 0%, 
                #2d1810 20%,
                #3e2415 40%, 
                #5d3a1f 60%,
                #8b4513 80%,
                #cd7f32 100%
            );
            border-radius: 45% 45% 50% 50%;
            left: 15%;
            top: 5%;
            border: 1px solid #0f0a08;
            box-shadow: inset -3px 0 8px rgba(0,0,0,0.5),
                        inset 3px 0 8px rgba(139,69,19,0.3);
        }

        /* ×¨××© ×”×’'×•×§ */
        .bug::after {
            content: '';
            position: absolute;
            width: 50%;
            height: 25%;
            background: radial-gradient(ellipse, #2d1810, #1a0f0a);
            border-radius: 50% 50% 30% 30%;
            left: 25%;
            top: 0%;
            border: 1px solid #0f0a08;
        }

        /* ×›× ×¤×™×™× ×›×ª×•××•×ª */
        .bug-wing {
            position: absolute;
            width: 28%;
            height: 65%;
            background: linear-gradient(135deg, 
                #d2691e 0%,
                #cd853f 30%,
                #f4a460 50%,
                #daa520 70%,
                #b8860b 100%
            );
            border-radius: 15px 50px 50px 15px;
            top: 15%;
            border: 1px solid #8b4513;
            opacity: 0.9;
        }

        .bug-wing.left {
            left: 8%;
            transform: rotate(-5deg);
        }

        .bug-wing.right {
            right: 8%;
            transform: rotate(5deg) scaleX(-1);
        }

        /* ×¤×¡×™× ×¢×œ ×”×’×‘ */
        .bug-stripe {
            position: absolute;
            width: 60%;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent,
                rgba(139, 69, 19, 0.6),
                transparent
            );
            left: 20%;
        }

        .bug-stripe:nth-child(1) { top: 25%; }
        .bug-stripe:nth-child(2) { top: 35%; }
        .bug-stripe:nth-child(3) { top: 45%; }
        .bug-stripe:nth-child(4) { top: 55%; }

        .bug-antennae {
            position: absolute;
            width: 1.5px;
            height: 30px;
            background: linear-gradient(to bottom, 
                #3e2415 0%,
                #5d3a1f 50%,
                transparent 100%
            );
            top: -20px;
        }

        .bug-antennae.left {
            left: 18px;
            transform: rotate(-25deg);
        }

        .bug-antennae.right {
            right: 18px;
            transform: rotate(25deg);
        }

        .bug-leg {
            position: absolute;
            width: 25px;
            height: 2.5px;
            background: linear-gradient(90deg, 
                #1a0f0a,
                #2d1810 60%,
                transparent
            );
            animation: wiggleLeg 0.3s infinite alternate;
            border-radius: 2px;
            will-change: transform;
        }

        /* ×§×•×¦×™× ×¢×œ ×”×¨×’×œ×™×™× */
        .bug-leg::before,
        .bug-leg::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 1.5px;
            background: #1a0f0a;
        }

        .bug-leg::before {
            left: 30%;
            top: 0px;
            transform: rotate(-50deg);
        }

        .bug-leg::after {
            left: 60%;
            top: 0px;
            transform: rotate(-50deg);
        }

        @keyframes wiggleLeg {
            0% {
                transform: rotate(var(--leg-angle)) translateY(0);
            }
            100% {
                transform: rotate(var(--leg-angle)) translateY(-1.5px);
            }
        }

        .bug-leg.left1 {
            left: -5px;
            top: 28px;
            --leg-angle: -60deg;
            z-index: -1;
        }

        .bug-leg.left2 {
            left: -8px;
            top: 45px;
            --leg-angle: -75deg;
            z-index: -1;
        }

        .bug-leg.left3 {
            left: -5px;
            top: 62px;
            --leg-angle: -90deg;
            z-index: -1;
        }

        .bug-leg.right1 {
            right: -5px;
            top: 28px;
            --leg-angle: 60deg;
            transform-origin: right center;
            z-index: -1;
        }

        .bug-leg.right2 {
            right: -8px;
            top: 45px;
            --leg-angle: 75deg;
            transform-origin: right center;
            z-index: -1;
        }

        .bug-leg.right3 {
            right: -5px;
            top: 62px;
            --leg-angle: 90deg;
            transform-origin: right center;
            z-index: -1;
        }

        .bug:hover {
            transform: scale(1.2);
        }

        .bug.squashed {
            animation: squash 0.3s ease-out forwards;
        }

        @keyframes squash {
            0% {
                transform: scale(1) rotate(0deg);
            }
            50% {
                transform: scale(1.3) rotate(15deg);
            }
            100% {
                transform: scale(0) rotate(45deg);
                opacity: 0;
            }
        }

        .splat {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(220, 38, 38, 0.9) 0%, rgba(185, 28, 28, 0.7) 30%, rgba(153, 27, 27, 0.5) 60%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            animation: splatAppear 0.3s ease-out;
        }

        .splat::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(220, 38, 38, 0.8);
            border-radius: 50%;
            top: -10px;
            left: 30px;
        }

        .splat::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: rgba(185, 28, 28, 0.7);
            border-radius: 50%;
            bottom: -5px;
            right: 20px;
        }

        @keyframes splatAppear {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0.8;
            }
        }

        .score-popup {
            position: absolute;
            font-size: 2.5em;
            font-weight: bold;
            color: #56ab2f;
            pointer-events: none;
            animation: scoreFloat 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            z-index: 100;
        }

        @keyframes scoreFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        .winner-screen {
            display: none;
            background: white;
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            text-align: center;
            animation: slideIn 0.5s ease;
        }

        .winner-title {
            font-size: 3em;
            color: #56ab2f;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .winner-stats {
            font-size: 1.5em;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .play-again-btn {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.3em;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .play-again-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(86, 171, 47, 0.6);
        }

        .feedback-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .feedback-overlay.active {
            display: flex;
        }

        .feedback-message {
            background: white;
            padding: 50px 80px;
            border-radius: 25px;
            font-size: 3em;
            font-weight: bold;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .feedback-message.correct {
            color: #4ade80;
        }

        .feedback-message.wrong {
            color: #f87171;
        }


    </style>
</head>
<body>
    <div class="menu-container" id="menu">
        <h1>ğŸ•·ï¸ ×¦×™×“ ×’'×•×§×™× ğŸª³</h1>
        <p class="subtitle">×›×¤×œ ×•×—×™×œ×•×§ - ×›×™×ª×•×ª ×’' ×•-×“'</p>
        
        <div class="mode-buttons">
            <button class="mode-btn" onclick="selectMode('single')">ğŸ¯ ×©×—×§×Ÿ ×™×—×™×“</button>
            <button class="mode-btn" onclick="selectMode('teams')">ğŸ‘¥ ×©× ×™ ×©×—×§× ×™×</button>
        </div>

        <div class="difficulty-selector" id="difficultySelector" style="display: none;">
            <h3>×‘×—×¨ ×¨××ª ×§×•×©×™:</h3>
            <div class="difficulty-buttons">
                <button class="difficulty-btn" onclick="selectDifficulty('easy')">×§×œ (×œ×•×— 1-5)</button>
                <button class="difficulty-btn" onclick="selectDifficulty('medium')">×‘×™× ×•× ×™ (×œ×•×— 1-10)</button>
                <button class="difficulty-btn" onclick="selectDifficulty('hard')">×§×©×” (×œ×•×— 1-12)</button>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer">
        <div class="game-header">
            <button class="back-button" onclick="backToMenu()">â† ×—×–×¨×”</button>
            <div class="round-info" id="roundInfo">×¡×™×‘×•×‘ 1 ××ª×•×š 10</div>
            <div class="single-score-display" id="singleScoreDisplay" style="display: none;">
                <span style="font-size: 1.8em; color: #56ab2f; font-weight: bold;">
                    × ×™×§×•×“: <span id="singlePlayerScore">0</span>
                </span>
            </div>
        </div>

        <div class="players-display" id="playersDisplay">
            <div class="player-card player1" id="player1Card">
                <div class="player-name">ğŸª³ ×©×—×§×Ÿ 1</div>
                <div class="player-score" id="player1Score">0</div>
                <div class="turn-indicator">â­ ×”×ª×•×¨ ×©×œ×š! â­</div>
            </div>
            <div class="player-card player2" id="player2Card">
                <div class="player-name">ğŸª³ ×©×—×§×Ÿ 2</div>
                <div class="player-score" id="player2Score">0</div>
                <div class="turn-indicator">â­ ×”×ª×•×¨ ×©×œ×š! â­</div>
            </div>
        </div>

        <div class="question-section" id="questionSection">
            <div class="question-text" id="questionText">5 + 3 = ?</div>
            <div class="answer-buttons" id="answerButtons"></div>
        </div>

        <div class="bug-arena" id="bugArena">
            <div class="arena-header">
                <div>× ×™×§×•×“: <span id="currentScore">0</span></div>
                <div>×—×¨×§×™×: <span id="bugCount">0</span></div>
                <div>ğŸ•·ï¸ × ×ª×¤×¡×•: <span id="comboCount">0</span></div>
            </div>
            <div class="timer-bar">
                <div class="timer-fill" id="timerFill"></div>
            </div>
            <div class="game-area" id="gameArea"></div>
        </div>
    </div>

    <div class="winner-screen" id="winnerScreen">
        <div class="winner-title" id="winnerTitle">ğŸ† ×”××©×—×§ ×”×¡×ª×™×™×! ğŸ†</div>
        <div class="winner-stats" id="winnerStats"></div>
        <button class="play-again-btn" onclick="backToMenu()">×©×—×§ ×©×•×‘</button>
    </div>

    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-message" id="feedbackMessage"></div>
    </div>

    <script>
        let gameMode = '';
        let difficulty = '';
        let currentRound = 1;
        let maxRounds = 10;
        let player1TotalScore = 0;
        let player2TotalScore = 0;
        let currentPlayer = 1;
        let currentQuestion = {};
        let currentRoundScore = 0;
        let bugInterval = null;
        let timerInterval = null;
        let timeLeft = 16;
        let maxTime = 16;
        let bugsSquashed = 0;
        let totalBugsSpawned = 0;

        const bugs = ['ğŸª³', 'ğŸª³', 'ğŸª³', 'ğŸª³', 'ğŸª³', 'ğŸª³'];

        function selectMode(mode) {
            gameMode = mode;
            document.getElementById('difficultySelector').style.display = 'block';
        }

        function selectDifficulty(diff) {
            difficulty = diff;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            setTimeout(() => {
                startGame();
            }, 500);
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            currentRound = 1;
            player1TotalScore = 0;
            player2TotalScore = 0;
            currentPlayer = 1;
            
            if (gameMode === 'teams') {
                document.getElementById('playersDisplay').classList.add('active');
                document.getElementById('singleScoreDisplay').style.display = 'none';
                updatePlayersDisplay();
            } else {
                document.getElementById('playersDisplay').classList.remove('active');
                document.getElementById('singleScoreDisplay').style.display = 'block';
                document.getElementById('singlePlayerScore').textContent = '0';
            }
            
            generateQuestion();
        }

        function generateQuestion() {
            let num1, num2, operation;
            let minNum, maxNum;
            
            // ×˜×•×•×—×™× × ×¤×¨×“×™× ×œ×›×œ ×¨××ª ×§×•×©×™
            if (difficulty === 'easy') {
                minNum = 1;
                maxNum = 5;
            } else if (difficulty === 'medium') {
                minNum = 6;
                maxNum = 10;
            } else { // hard
                minNum = 11;
                maxNum = 12;
            }
            
            operation = Math.random() < 0.5 ? 'Ã—' : 'Ã·';
            
            if (operation === 'Ã—') {
                // ×›×¤×œ
                num1 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                num2 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                currentQuestion.answer = num1 * num2;
            } else {
                // ×—×™×œ×•×§ - ×•×™×“×•× ×©×”×ª×©×•×‘×” ×ª×”×™×” ×©×œ××”
                num2 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                let result = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                num1 = num2 * result;
                currentQuestion.answer = result;
            }
            
            currentQuestion.text = `${num1} ${operation} ${num2} = ?`;
            
            document.getElementById('questionText').textContent = currentQuestion.text;
            document.getElementById('roundInfo').textContent = `×¡×™×‘×•×‘ ${currentRound} ××ª×•×š ${maxRounds}`;
            
            generateAnswerButtons();
            
            document.getElementById('questionSection').style.display = 'block';
            document.getElementById('bugArena').style.display = 'none';
        }

        function generateAnswerButtons() {
            const container = document.getElementById('answerButtons');
            container.innerHTML = '';
            
            let answers = [currentQuestion.answer];
            
            while (answers.length < 4) {
                let wrongAnswer = currentQuestion.answer + Math.floor(Math.random() * 10) - 5;
                if (wrongAnswer !== currentQuestion.answer && wrongAnswer > 0 && !answers.includes(wrongAnswer)) {
                    answers.push(wrongAnswer);
                }
            }
            
            answers.sort(() => Math.random() - 0.5);
            
            answers.forEach(answer => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => checkAnswer(answer);
                container.appendChild(btn);
            });
        }

        function checkAnswer(answer) {
            const isCorrect = answer === currentQuestion.answer;
            
            showFeedback(isCorrect ? '× ×›×•×Ÿ! ×–××Ÿ ×œ×¦×•×“ ×’\'×•×§×™×! ğŸ•·ï¸' : '×œ× × ×›×•×Ÿ ğŸ˜', isCorrect ? 'correct' : 'wrong');
            playSound(isCorrect ? 'correct' : 'wrong');
            
            if (isCorrect) {
                setTimeout(() => {
                    startBugPhase();
                }, 1500);
            } else {
                setTimeout(() => {
                    nextRound();
                }, 1500);
            }
        }

        function startBugPhase() {
            document.getElementById('questionSection').style.display = 'none';
            document.getElementById('bugArena').style.display = 'block';
            
            currentRoundScore = 0;
            bugsSquashed = 0;
            totalBugsSpawned = 0;
            timeLeft = maxTime;
            
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('comboCount').textContent = '0';
            document.getElementById('bugCount').textContent = '0';
            
            // ×’×œ×™×œ×” ×—×œ×§×” ×œ××–×•×¨ ×”××©×—×§
            setTimeout(() => {
                document.getElementById('bugArena').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
            
            updateTimer();
            timerInterval = setInterval(updateTimer, 100);
            
            bugInterval = setInterval(spawnBug, 800);
        }

        function spawnBug() {
            const gameArea = document.getElementById('gameArea');
            const bug = document.createElement('div');
            bug.className = 'bug';
            
            // ×”×•×¡×¤×ª ×›× ×¤×™×™×
            const wingLeft = document.createElement('div');
            wingLeft.className = 'bug-wing left';
            bug.appendChild(wingLeft);
            
            const wingRight = document.createElement('div');
            wingRight.className = 'bug-wing right';
            bug.appendChild(wingRight);
            
            // ×”×•×¡×¤×ª ×¤×¡×™× ×¢×œ ×”×’×‘
            for (let i = 0; i < 4; i++) {
                const stripe = document.createElement('div');
                stripe.className = 'bug-stripe';
                bug.appendChild(stripe);
            }
            
            // ×”×•×¡×¤×ª ×× ×˜× ×•×ª
            const antennaLeft = document.createElement('div');
            antennaLeft.className = 'bug-antennae left';
            bug.appendChild(antennaLeft);
            
            const antennaRight = document.createElement('div');
            antennaRight.className = 'bug-antennae right';
            bug.appendChild(antennaRight);
            
            // ×”×•×¡×¤×ª ×¨×’×œ×™×™× ×¢× ×§×•×¦×™×
            const legs = ['left1', 'left2', 'left3', 'right1', 'right2', 'right3'];
            legs.forEach(legClass => {
                const leg = document.createElement('div');
                leg.className = `bug-leg ${legClass}`;
                bug.appendChild(leg);
            });
            
            const startSide = Math.floor(Math.random() * 4);
            let startX, startY, endX, endY;
            
            const maxX = gameArea.offsetWidth - 100;
            const maxY = gameArea.offsetHeight - 100;
            
            switch(startSide) {
                case 0: // ××œ××¢×œ×”
                    startX = Math.random() * maxX;
                    startY = -100;
                    endX = Math.random() * maxX;
                    endY = maxY;
                    break;
                case 1: // ××™××™×Ÿ
                    startX = maxX + 100;
                    startY = Math.random() * maxY;
                    endX = 0;
                    endY = Math.random() * maxY;
                    break;
                case 2: // ××œ××˜×”
                    startX = Math.random() * maxX;
                    startY = maxY + 100;
                    endX = Math.random() * maxX;
                    endY = 0;
                    break;
                case 3: // ××©×××œ
                    startX = -100;
                    startY = Math.random() * maxY;
                    endX = maxX;
                    endY = Math.random() * maxY;
                    break;
            }
            
            bug.style.left = startX + 'px';
            bug.style.top = startY + 'px';
            
            bug.onclick = () => squashBug(bug);
            
            gameArea.appendChild(bug);
            totalBugsSpawned++;
            updateBugCount();
            
            const duration = 5000 + Math.random() * 3000;
            
            animateBug(bug, startX, startY, endX, endY, duration);
            
            setTimeout(() => {
                if (bug.parentElement && !bug.classList.contains('squashed')) {
                    bug.remove();
                }
            }, duration);
        }

        function animateBug(bug, startX, startY, endX, endY, duration) {
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentX = startX + (endX - startX) * progress;
                const currentY = startY + (endY - startY) * progress;
                
                bug.style.left = currentX + 'px';
                bug.style.top = currentY + 'px';
                
                const angle = Math.atan2(endY - startY, endX - startX) * (180 / Math.PI);
                bug.style.transform = `rotate(${angle}deg)`;
                
                if (progress < 1 && bug.parentElement && !bug.classList.contains('squashed')) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        function squashBug(bug) {
            if (bug.classList.contains('squashed')) return;
            
            bug.classList.add('squashed');
            bugsSquashed++;
            
            let points = 10; // ×›×œ ×’'×•×§ ×©×•×•×” 10 × ×§×•×“×•×ª
            
            currentRoundScore += points;
            
            document.getElementById('currentScore').textContent = currentRoundScore;
            document.getElementById('comboCount').textContent = bugsSquashed; // ××¦×™×’ ×›××” ×’'×•×§×™× × ×ª×¤×¡×•
            updateBugCount();
            
            createSplat(bug);
            showScorePopup(points, bug);
            playSound('squash');
            
            setTimeout(() => bug.remove(), 300);
        }

        function createSplat(bug) {
            const splat = document.createElement('div');
            splat.className = 'splat';
            splat.style.left = bug.style.left;
            splat.style.top = bug.style.top;
            
            // ×”×•×¡×¤×ª ×˜×™×¤×•×ª ×“× × ×•×¡×¤×•×ª ×‘××•×¤×Ÿ ××§×¨××™
            const rotation = Math.random() * 360;
            splat.style.transform = `rotate(${rotation}deg)`;
            
            document.getElementById('gameArea').appendChild(splat);
            
            // ×™×¦×™×¨×ª ×˜×™×¤×•×ª ×“× ×§×˜× ×•×ª × ×•×¡×¤×•×ª
            for (let i = 0; i < 5; i++) {
                const drop = document.createElement('div');
                drop.style.position = 'absolute';
                drop.style.width = (5 + Math.random() * 10) + 'px';
                drop.style.height = (5 + Math.random() * 10) + 'px';
                drop.style.background = `rgba(${200 + Math.random() * 50}, 38, 38, ${0.6 + Math.random() * 0.3})`;
                drop.style.borderRadius = '50%';
                drop.style.pointerEvents = 'none';
                
                const offsetX = parseFloat(bug.style.left) + (Math.random() - 0.5) * 80;
                const offsetY = parseFloat(bug.style.top) + (Math.random() - 0.5) * 80;
                
                drop.style.left = offsetX + 'px';
                drop.style.top = offsetY + 'px';
                
                document.getElementById('gameArea').appendChild(drop);
                
                setTimeout(() => {
                    drop.style.opacity = '0.4';
                }, 300);
            }
            
            setTimeout(() => {
                splat.style.opacity = '0.5';
            }, 300);
        }

        function showScorePopup(points, element) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = '+' + points;
            popup.style.left = element.style.left;
            popup.style.top = element.style.top;
            
            document.getElementById('gameArea').appendChild(popup);
            
            setTimeout(() => popup.remove(), 1000);
        }

        function showCombo(comboCount) {
            // ×¤×©×•×˜ ×× ×’×Ÿ ×¦×œ×™×œ - ×œ×œ× ×˜×§×¡×˜ ×›×‘×“ ×¢×œ ×”××¡×š
            // ×”×§×•××‘×• ×›×‘×¨ × ×¨××” ×‘×¤×™× ×” ×”×¢×œ×™×•× ×”
        }

        function updateBugCount() {
            const activeBugs = document.querySelectorAll('.bug:not(.squashed)').length;
            document.getElementById('bugCount').textContent = `${bugsSquashed}/${totalBugsSpawned}`;
        }

        function updateTimer() {
            timeLeft -= 0.1;
            
            const percentage = (timeLeft / maxTime) * 100;
            document.getElementById('timerFill').style.width = percentage + '%';
            document.getElementById('timerFill').textContent = Math.ceil(timeLeft) + 's';
            
            if (timeLeft <= 0) {
                endBugPhase();
            }
        }

        function endBugPhase() {
            clearInterval(bugInterval);
            clearInterval(timerInterval);
            
            const gameArea = document.getElementById('gameArea');
            const bugs = gameArea.querySelectorAll('.bug');
            bugs.forEach(bug => bug.remove());
            
            // ×× ×§×™× ××ª ×›×œ ×›×ª××™ ×”×“× ×•×”×˜×™×¤×•×ª
            gameArea.innerHTML = '';
            
            if (gameMode === 'teams') {
                if (currentPlayer === 1) {
                    player1TotalScore += currentRoundScore;
                } else {
                    player2TotalScore += currentRoundScore;
                }
                updatePlayersDisplay();
            } else {
                player1TotalScore += currentRoundScore;
                document.getElementById('singlePlayerScore').textContent = player1TotalScore;
            }
            
            setTimeout(() => {
                nextRound();
            }, 1000);
        }

        function nextRound() {
            if (gameMode === 'teams') {
                if (currentPlayer === 1) {
                    currentPlayer = 2;
                    updatePlayersDisplay();
                    showPlayerTurnMessage();
                } else {
                    currentPlayer = 1;
                    currentRound++;
                    
                    if (currentRound > maxRounds) {
                        endGame();
                    } else {
                        updatePlayersDisplay();
                        showPlayerTurnMessage();
                    }
                }
            } else {
                currentRound++;
                if (currentRound > maxRounds) {
                    endGame();
                } else {
                    generateQuestion();
                }
            }
        }

        function showPlayerTurnMessage() {
            showFeedback(`×ª×•×¨ ×©×—×§×Ÿ ${currentPlayer}! ğŸª³`, 'correct');
            setTimeout(() => {
                generateQuestion();
            }, 2000);
        }

        function updatePlayersDisplay() {
            const player1Card = document.getElementById('player1Card');
            const player2Card = document.getElementById('player2Card');
            
            document.getElementById('player1Score').textContent = player1TotalScore;
            document.getElementById('player2Score').textContent = player2TotalScore;
            
            if (currentPlayer === 1) {
                player1Card.classList.add('active-player');
                player2Card.classList.remove('active-player');
            } else {
                player1Card.classList.remove('active-player');
                player2Card.classList.add('active-player');
            }
        }

        function endGame() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('winnerScreen').style.display = 'block';
            
            playSound('win');
            
            let stats = '';
            
            if (gameMode === 'teams') {
                if (player1TotalScore > player2TotalScore) {
                    document.getElementById('winnerTitle').textContent = 'ğŸ† ×©×—×§×Ÿ 1 × ×™×¦×—! ğŸ†';
                    stats = `×©×—×§×Ÿ 1: ${player1TotalScore} × ×§×•×“×•×ª<br>×©×—×§×Ÿ 2: ${player2TotalScore} × ×§×•×“×•×ª`;
                } else if (player2TotalScore > player1TotalScore) {
                    document.getElementById('winnerTitle').textContent = 'ğŸ† ×©×—×§×Ÿ 2 × ×™×¦×—! ğŸ†';
                    stats = `×©×—×§×Ÿ 2: ${player2TotalScore} × ×§×•×“×•×ª<br>×©×—×§×Ÿ 1: ${player1TotalScore} × ×§×•×“×•×ª`;
                } else {
                    document.getElementById('winnerTitle').textContent = 'ğŸ¤ ×ª×™×§×•! ğŸ¤';
                    stats = `×©× ×™ ×”×©×—×§× ×™× ×¦×‘×¨×• ${player1TotalScore} × ×§×•×“×•×ª!`;
                }
            } else {
                const avgPerRound = Math.round(player1TotalScore / maxRounds);
                stats = `×¡×š ×”×›×œ: ${player1TotalScore} × ×§×•×“×•×ª ğŸª³<br>×××•×¦×¢ ×œ×¡×™×‘×•×‘: ${avgPerRound}`;
                
                if (player1TotalScore >= 300) {
                    document.getElementById('winnerTitle').textContent = 'ğŸŒŸ ××•×©×œ×! ×¦×™×™×“ ×’\'×•×§×™× ××§×¦×•×¢×™! ğŸŒŸ';
                } else if (player1TotalScore >= 200) {
                    document.getElementById('winnerTitle').textContent = 'ğŸ‰ ××¦×•×™×Ÿ! ×¦×™×™×“ ×’\'×•×§×™×! ğŸ‰';
                } else if (player1TotalScore >= 100) {
                    document.getElementById('winnerTitle').textContent = 'ğŸ‘ ×™×¤×” ×××•×“! ğŸ‘';
                } else {
                    document.getElementById('winnerTitle').textContent = 'ğŸ’ª ×”××©×š ×œ×”×ª×××Ÿ! ğŸ’ª';
                }
            }
            
            document.getElementById('winnerStats').innerHTML = stats;
        }

        function showFeedback(message, type) {
            const overlay = document.getElementById('feedbackOverlay');
            const messageDiv = document.getElementById('feedbackMessage');
            
            messageDiv.textContent = message;
            messageDiv.className = 'feedback-message ' + type;
            overlay.classList.add('active');
            
            setTimeout(() => {
                overlay.classList.remove('active');
            }, 1500);
        }

        function backToMenu() {
            clearInterval(bugInterval);
            clearInterval(timerInterval);
            
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('winnerScreen').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
            document.getElementById('difficultySelector').style.display = 'none';
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            } else if (type === 'wrong') {
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.15);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'squash') {
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'combo') {
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(1200, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'win') {
                const notes = [523.25, 659.25, 783.99, 1046.50];
                notes.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.15);
                    gain.gain.setValueAtTime(0.3, audioContext.currentTime + i * 0.15);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
                    osc.start(audioContext.currentTime + i * 0.15);
                    osc.stop(audioContext.currentTime + i * 0.15 + 0.3);
                });
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>למד לצייר חגים ואירועים</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .title {
            text-align: center;
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            flex-wrap: wrap;
            justify-content: center;
        }
        .canvas-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 300px;
        }
        .canvas-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }
        canvas {
            border: 3px solid #667eea;
            border-radius: 15px;
            cursor: none;
            display: block;
            margin: 0 auto;
            background: white;
        }
        #cursor {
            position: fixed;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #000, inset 0 0 0 2px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            display: none;
            transform: translate(-50%, -50%);
        }
        #cursor::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1px;
            height: 10px;
            background: #000;
            box-shadow: 1px 0 0 #fff, -1px 0 0 #fff;
        }
        #cursor::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 1px;
            background: #000;
            box-shadow: 0 1px 0 #fff, 0 -1px 0 #fff;
        }
        .controls {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .control-section { text-align: center; }
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .instruction-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .step-counter {
            font-size: 1.1em;
            color: #666;
            margin-top: 10px;
        }
        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        .nav-buttons { display: flex; gap: 10px; }
        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            justify-items: center;
        }
        .color-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }
        .color-btn:hover { transform: scale(1.2); }
        .color-btn.selected {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            transform: scale(1.2);
        }
        .tool-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 10px;
        }
        .tool-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s;
        }
        .tool-btn:hover { transform: scale(1.1); }
        .tool-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        .drawing-menu {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            max-width: 600px;
            width: 90%;
        }
        .drawing-menu.hidden { display: none; }
        .menu-title {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .drawing-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .drawing-option {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .drawing-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: #667eea;
        }
        .drawing-icon { font-size: 3em; margin-bottom: 10px; }
        .drawing-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        .difficulty-stars {
            color: #FFD700;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .overlay.hidden { display: none; }
        .size-slider { width: 100%; margin: 10px 0; }
    </style>
</head>
<body>
    <div id="cursor"></div>
    <div class="overlay hidden" id="overlay"></div>
    
    <div class="drawing-menu" id="drawingMenu">
        <div class="menu-title">🎉 בחר ציור חגיגי</div>
        <div class="drawing-options">
            <div class="drawing-option" onclick="selectDrawing('gift')">
                <div class="drawing-icon">🎁</div>
                <div class="drawing-name">מתנה עטופה</div>
                <div class="difficulty-stars">★★☆☆☆</div>
            </div>
            <div class="drawing-option" onclick="selectDrawing('mask')">
                <div class="drawing-icon">🎭</div>
                <div class="drawing-name">מסכת פורים</div>
                <div class="difficulty-stars">★★★☆☆</div>
            </div>
            <div class="drawing-option" onclick="selectDrawing('menorah')">
                <div class="drawing-icon">🕎</div>
                <div class="drawing-name">חנוכייה</div>
                <div class="difficulty-stars">★★★☆☆</div>
            </div>
            <div class="drawing-option" onclick="selectDrawing('candyhouse')">
                <div class="drawing-icon">🏠</div>
                <div class="drawing-name">בית ממתקים</div>
                <div class="difficulty-stars">★★★★☆</div>
            </div>
        </div>
    </div>
    
    <div class="title">🎉 למד לצייר חגים ואירועים - שלב אחר שלב! 🎨</div>
    
    <div class="main-container">
        <div class="canvas-container">
            <div class="canvas-title">הדוגמה - עקוב אחרי השלבים 👀</div>
            <canvas id="exampleCanvas" width="400" height="400"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-section">
                <div class="instruction-box" id="instruction">בחר ציור חגיגי מהתפריט כדי להתחיל!</div>
                <div class="step-counter" id="stepCounter"></div>
            </div>
            
            <div class="control-section">
                <div class="section-title">כלים 🛠️</div>
                <div class="tool-buttons">
                    <button class="tool-btn active" id="drawBtn" onclick="selectDrawTool()">✏️ עט</button>
                    <button class="tool-btn" id="eraserBtn" onclick="selectEraser()">🧹 מחק</button>
                </div>
            </div>
            
            <div class="control-section">
                <div class="section-title">צבעים 🎨</div>
                <div class="color-palette" id="colorPalette"></div>
            </div>
            
            <div class="control-section">
                <div class="section-title">עובי מכחול</div>
                <input type="range" class="size-slider" id="brushSize" min="2" max="15" value="5">
            </div>
            
            <div class="control-section">
                <div class="nav-buttons">
                    <button class="button" id="prevBtn" onclick="prevStep()" disabled>⬅️ קודם</button>
                    <button class="button" id="nextBtn" onclick="nextStep()" disabled>הבא ➡️</button>
                </div>
            </div>
            
            <button class="button" onclick="clearMyCanvas()">🗑️ נקה את הציור שלי</button>
            <button class="button" onclick="saveDrawing()">💾 שמור את הציור שלי</button>
            <button class="button" onclick="showMenu()">🎨 בחר ציור אחר</button>
        </div>
        
        <div class="canvas-container">
            <div class="canvas-title">הציור שלך - צייר כאן! ✏️</div>
            <canvas id="myCanvas" width="400" height="400"></canvas>
        </div>
    </div>

    <script>
        const ex = document.getElementById('exampleCanvas');
        const my = document.getElementById('myCanvas');
        const exCtx = ex.getContext('2d');
        const myCtx = my.getContext('2d');
        const cursor = document.getElementById('cursor');
        
        let curr = null;
        let step = 0;
        let draw = false;
        let col = '#000000';
        let size = 5;
        let erase = false;
        
        function updCursor() {
            const s = erase ? size * 4 : size * 2;
            cursor.style.width = s + 'px';
            cursor.style.height = s + 'px';
            if (erase) {
                cursor.style.borderColor = '#fff';
                cursor.style.boxShadow = '0 0 0 2px #ff0000, inset 0 0 0 2px #ff0000';
            } else {
                cursor.style.borderColor = '#fff';
                cursor.style.boxShadow = '0 0 0 2px #000, inset 0 0 0 2px ' + col;
            }
        }
        
        my.addEventListener('mouseenter', () => {
            cursor.style.display = 'block';
            updCursor();
        });
        
        my.addEventListener('mouseleave', () => {
            cursor.style.display = 'none';
        });
        
        my.addEventListener('mousemove', (e) => {
            cursor.style.left = e.pageX + 'px';
            cursor.style.top = e.pageY + 'px';
        });
        
        const cols = [
            '#000000','#FFFFFF','#FF0000','#00FF00','#0000FF',
            '#FFFF00','#FFA500','#800080','#FF00FF','#00FFFF',
            '#FFC0CB','#00BFFF','#87CEEB','#FFD700','#FF69B4',
            '#FF1493','#8B4513','#FFE4B5','#FFDAB9','#8B0000',
            '#DC143C','#006400','#000080','#90EE90','#FF6347'
        ];

        const data = {
            gift: {
                name: 'מתנה עטופה',
                steps: [
                    {instruction:'שלב 1: רקע ורוד',draw:c=>{c.fillStyle='#FFC0CB';c.fillRect(0,0,400,400)}},
                    {instruction:'שלב 2: קופסה אדומה',draw:c=>{c.fillStyle='#FF0000';c.fillRect(120,160,160,140)}},
                    {instruction:'שלב 3: מכסה',draw:c=>{c.fillStyle='#DC143C';c.fillRect(110,140,180,25)}},
                    {instruction:'שלב 4: סרט אנכי',draw:c=>{c.fillStyle='#FFD700';c.fillRect(185,140,30,160)}},
                    {instruction:'שלב 5: סרט אופקי',draw:c=>{c.fillStyle='#FFD700';c.fillRect(110,210,180,25)}},
                    {instruction:'שלב 6: פפיון שמאל',draw:c=>{c.fillStyle='#FFD700';c.beginPath();c.moveTo(200,125);c.quadraticCurveTo(170,105,150,125);c.quadraticCurveTo(170,130,200,135);c.closePath();c.fill()}},
                    {instruction:'שלב 7: פפיון ימין',draw:c=>{c.fillStyle='#FFD700';c.beginPath();c.moveTo(200,125);c.quadraticCurveTo(230,105,250,125);c.quadraticCurveTo(230,130,200,135);c.closePath();c.fill()}},
                    {instruction:'שלב 8: מרכז פפיון',draw:c=>{c.fillStyle='#FFA500';c.fillRect(195,123,10,15)}},
                    {instruction:'שלב 9: נקודה 1',draw:c=>{c.fillStyle='#FFF';c.beginPath();c.arc(145,240,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 10: נקודה 2',draw:c=>{c.fillStyle='#FFF';c.beginPath();c.arc(255,240,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 11: נקודה 3',draw:c=>{c.fillStyle='#FFF';c.beginPath();c.arc(145,270,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 12: נקודה 4',draw:c=>{c.fillStyle='#FFF';c.beginPath();c.arc(255,270,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 13: כוכב 1',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=60+Math.cos(a)*12;let y=120+Math.sin(a)*12;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}},
                    {instruction:'שלב 14: כוכב 2',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=340+Math.cos(a)*12;let y=110+Math.sin(a)*12;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}},
                    {instruction:'שלב 15: כוכב 3',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=70+Math.cos(a)*12;let y=270+Math.sin(a)*12;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}},
                    {instruction:'שלב 16: כוכב 4',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=330+Math.cos(a)*12;let y=280+Math.sin(a)*12;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}}
                ]
            },
            mask: {
                name: 'מסכת פורים',
                steps: [
                    {instruction:'שלב 1: רקע סגול',draw:c=>{c.fillStyle='#800080';c.fillRect(0,0,400,400)}},
                    {instruction:'שלב 2: מסכה זהובה',draw:c=>{c.fillStyle='#FFD700';c.beginPath();c.ellipse(200,187,95,60,0,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 3: חלק עליון',draw:c=>{c.fillStyle='#FFD700';c.beginPath();c.ellipse(200,160,83,35,0,Math.PI,0);c.fill()}},
                    {instruction:'שלב 4: עיטור שמאל',draw:c=>{c.fillStyle='#FF00FF';c.beginPath();c.ellipse(125,173,23,35,-0.3,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 5: עיטור ימין',draw:c=>{c.fillStyle='#FF00FF';c.beginPath();c.ellipse(275,173,23,35,0.3,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 6: עין שמאל',draw:c=>{c.fillStyle='#000';c.beginPath();c.ellipse(170,180,18,24,-0.2,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 7: עין ימין',draw:c=>{c.fillStyle='#000';c.beginPath();c.ellipse(230,180,18,24,0.2,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 8: מתאר עין שמאל',draw:c=>{c.strokeStyle='#FFF';c.lineWidth=3;c.beginPath();c.ellipse(170,180,22,28,-0.2,0,Math.PI*2);c.stroke()}},
                    {instruction:'שלב 9: מתאר עין ימין',draw:c=>{c.strokeStyle='#FFF';c.lineWidth=3;c.beginPath();c.ellipse(230,180,22,28,0.2,0,Math.PI*2);c.stroke()}},
                    {instruction:'שלב 10: יהלום 1',draw:c=>{c.fillStyle='#0FF';c.beginPath();c.moveTo(200,140);c.lineTo(205,145);c.lineTo(200,150);c.lineTo(195,145);c.closePath();c.fill()}},
                    {instruction:'שלב 11: יהלום 2',draw:c=>{c.fillStyle='#0FF';c.beginPath();c.moveTo(150,193);c.lineTo(155,198);c.lineTo(150,203);c.lineTo(145,198);c.closePath();c.fill()}},
                    {instruction:'שלב 12: יהלום 3',draw:c=>{c.fillStyle='#0FF';c.beginPath();c.moveTo(250,193);c.lineTo(255,198);c.lineTo(250,203);c.lineTo(245,198);c.closePath();c.fill()}},
                    {instruction:'שלב 13: יהלום 4',draw:c=>{c.fillStyle='#0FF';c.beginPath();c.moveTo(200,220);c.lineTo(205,225);c.lineTo(200,230);c.lineTo(195,225);c.closePath();c.fill()}},
                    {instruction:'שלב 14: נוצה 1 ימין',draw:c=>{c.fillStyle='#FF1493';c.beginPath();c.ellipse(230,115,15,42,0.5,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 15: נוצה 2 ימין',draw:c=>{c.fillStyle='#9370DB';c.beginPath();c.ellipse(248,107,12,36,0.7,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 16: נוצה 3 ימין',draw:c=>{c.fillStyle='#0FF';c.beginPath();c.ellipse(263,103,10,30,0.8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 17: נוצה 1 שמאל',draw:c=>{c.fillStyle='#FF1493';c.beginPath();c.ellipse(170,115,15,42,-0.5,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 18: נוצה 2 שמאל',draw:c=>{c.fillStyle='#9370DB';c.beginPath();c.ellipse(152,107,12,36,-0.7,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 19: נוצה 3 שמאל',draw:c=>{c.fillStyle='#0FF';c.beginPath();c.ellipse(137,103,10,30,-0.8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 20: סרט שמאל',draw:c=>{c.strokeStyle='#8B0000';c.lineWidth=5;c.beginPath();c.moveTo(105,187);c.lineTo(50,200);c.stroke()}},
                    {instruction:'שלב 21: סרט ימין',draw:c=>{c.strokeStyle='#8B0000';c.lineWidth=5;c.beginPath();c.moveTo(295,187);c.lineTo(350,200);c.stroke()}}
                ]
            },
            menorah: {
                name: 'חנוכייה',
                steps: [
                    {instruction:'שלב 1: רקע כחול',draw:c=>{c.fillStyle='#000080';c.fillRect(0,0,400,400)}},
                    {instruction:'שלב 2: בסיס',draw:c=>{c.fillStyle='#FFD700';c.fillRect(110,310,180,20)}},
                    {instruction:'שלב 3: רגל שמאל',draw:c=>{c.fillStyle='#FFD700';c.fillRect(130,330,15,15)}},
                    {instruction:'שלב 4: רגל ימין',draw:c=>{c.fillStyle='#FFD700';c.fillRect(255,330,15,15)}},
                    {instruction:'שלב 5: נר 1',draw:c=>{c.fillStyle='#F00';c.fillRect(127,230,13,80)}},
                    {instruction:'שלב 6: נר 2',draw:c=>{c.fillStyle='#00F';c.fillRect(153,230,13,80)}},
                    {instruction:'שלב 7: נר 3',draw:c=>{c.fillStyle='#FF0';c.fillRect(179,230,13,80)}},
                    {instruction:'שלב 8: נר 4',draw:c=>{c.fillStyle='#0F0';c.fillRect(205,230,13,80)}},
                    {instruction:'שלב 9: נר 5',draw:c=>{c.fillStyle='#FA0';c.fillRect(231,230,13,80)}},
                    {instruction:'שלב 10: נר 6',draw:c=>{c.fillStyle='#F0F';c.fillRect(257,230,13,80)}},
                    {instruction:'שלב 11: נר 7',draw:c=>{c.fillStyle='#0FF';c.fillRect(283,230,13,80)}},
                    {instruction:'שלב 12: שמש',draw:c=>{c.fillStyle='#FFF';c.fillRect(191,190,18,120)}},
                    {instruction:'שלב 13: פתיל 1',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(133.5,230);c.lineTo(133.5,215);c.stroke()}},
                    {instruction:'שלב 14: להבה 1',draw:c=>{c.fillStyle='#FA0';c.beginPath();c.moveTo(133.5,215);c.quadraticCurveTo(129,208,133.5,202);c.quadraticCurveTo(138,208,133.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(133.5,213);c.quadraticCurveTo(131,209,133.5,206);c.quadraticCurveTo(136,209,133.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 15: פתיל להבה 2',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(159.5,230);c.lineTo(159.5,215);c.stroke();c.fillStyle='#FA0';c.beginPath();c.moveTo(159.5,215);c.quadraticCurveTo(155,208,159.5,202);c.quadraticCurveTo(164,208,159.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(159.5,213);c.quadraticCurveTo(157,209,159.5,206);c.quadraticCurveTo(162,209,159.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 16: פתיל להבה 3',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(185.5,230);c.lineTo(185.5,215);c.stroke();c.fillStyle='#FA0';c.beginPath();c.moveTo(185.5,215);c.quadraticCurveTo(181,208,185.5,202);c.quadraticCurveTo(190,208,185.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(185.5,213);c.quadraticCurveTo(183,209,185.5,206);c.quadraticCurveTo(188,209,185.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 17: פתיל להבה 4',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(211.5,230);c.lineTo(211.5,215);c.stroke();c.fillStyle='#FA0';c.beginPath();c.moveTo(211.5,215);c.quadraticCurveTo(207,208,211.5,202);c.quadraticCurveTo(216,208,211.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(211.5,213);c.quadraticCurveTo(209,209,211.5,206);c.quadraticCurveTo(214,209,211.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 18: פתיל להבה 5',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(237.5,230);c.lineTo(237.5,215);c.stroke();c.fillStyle='#FA0';c.beginPath();c.moveTo(237.5,215);c.quadraticCurveTo(233,208,237.5,202);c.quadraticCurveTo(242,208,237.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(237.5,213);c.quadraticCurveTo(235,209,237.5,206);c.quadraticCurveTo(240,209,237.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 19: פתיל להבה 6',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(263.5,230);c.lineTo(263.5,215);c.stroke();c.fillStyle='#FA0';c.beginPath();c.moveTo(263.5,215);c.quadraticCurveTo(259,208,263.5,202);c.quadraticCurveTo(268,208,263.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(263.5,213);c.quadraticCurveTo(261,209,263.5,206);c.quadraticCurveTo(266,209,263.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 20: פתיל להבה 7',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(289.5,230);c.lineTo(289.5,215);c.stroke();c.fillStyle='#FA0';c.beginPath();c.moveTo(289.5,215);c.quadraticCurveTo(285,208,289.5,202);c.quadraticCurveTo(294,208,289.5,215);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(289.5,213);c.quadraticCurveTo(287,209,289.5,206);c.quadraticCurveTo(292,209,289.5,213);c.closePath();c.fill()}},
                    {instruction:'שלב 21: פתיל שמש',draw:c=>{c.strokeStyle='#000';c.lineWidth=2;c.beginPath();c.moveTo(200,190);c.lineTo(200,170);c.stroke()}},
                    {instruction:'שלב 22: להבת שמש',draw:c=>{c.fillStyle='#FA0';c.beginPath();c.moveTo(200,170);c.quadraticCurveTo(194,160,200,152);c.quadraticCurveTo(206,160,200,170);c.closePath();c.fill();c.fillStyle='#FF0';c.beginPath();c.moveTo(200,167);c.quadraticCurveTo(196,160,200,155);c.quadraticCurveTo(204,160,200,167);c.closePath();c.fill()}},
                    {instruction:'שלב 23: כוכב 1',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=200+Math.cos(a)*10;let y=60+Math.sin(a)*10;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}},
                    {instruction:'שלב 24: כוכב 2',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=70+Math.cos(a)*10;let y=150+Math.sin(a)*10;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}},
                    {instruction:'שלב 25: כוכב 3',draw:c=>{c.fillStyle='#FFD700';c.beginPath();for(let i=0;i<5;i++){let a=(i*4*Math.PI)/5-Math.PI/2;let x=330+Math.cos(a)*10;let y=150+Math.sin(a)*10;i===0?c.moveTo(x,y):c.lineTo(x,y)}c.closePath();c.fill()}}
                ]
            },
            candyhouse: {
                name: 'בית ממתקים',
                steps: [
                    {instruction:'שלב 1: רקע ורוד',draw:c=>{c.fillStyle='#FFC0CB';c.fillRect(0,0,400,400)}},
                    {instruction:'שלב 2: ענן 1',draw:c=>{c.fillStyle='#FFF';c.beginPath();c.arc(66,53,24,0,Math.PI*2);c.arc(93,46,30,0,Math.PI*2);c.arc(120,53,24,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 3: ענן 2',draw:c=>{c.fillStyle='#FFF';c.beginPath();c.arc(293,66,22,0,Math.PI*2);c.arc(316,60,26,0,Math.PI*2);c.arc(340,66,22,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 4: אדמה',draw:c=>{c.fillStyle='#8B4513';c.fillRect(0,293,400,107)}},
                    {instruction:'שלב 5: קירות',draw:c=>{c.fillStyle='#D2691E';c.fillRect(107,173,187,120)}},
                    {instruction:'שלב 6: נקודות עוגיה',draw:c=>{c.fillStyle='#8B4513';let d=[[130,200],[170,190],[220,210],[260,195],[140,240],[190,250],[240,235],[150,270],[210,280],[270,260]];d.forEach(p=>{c.beginPath();c.arc(p[0],p[1],3,0,Math.PI*2);c.fill()})}},
                    {instruction:'שלב 7: גג',draw:c=>{c.fillStyle='#FF69B4';c.beginPath();c.moveTo(93,173);c.lineTo(200,93);c.lineTo(307,173);c.closePath();c.fill()}},
                    {instruction:'שלב 8: זיגוג',draw:c=>{c.fillStyle='#FFF';for(let i=0;i<5;i++)c.fillRect(120+i*33,120+i*13,26,7)}},
                    {instruction:'שלב 9: סוכריה אדומה',draw:c=>{c.fillStyle='#F00';c.beginPath();c.arc(160,127,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 10: סוכריה ירוקה',draw:c=>{c.fillStyle='#0F0';c.beginPath();c.arc(200,107,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 11: סוכריה צהובה',draw:c=>{c.fillStyle='#FF0';c.beginPath();c.arc(240,127,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 12: ארובה',draw:c=>{c.fillStyle='#654321';c.fillRect(233,113,27,40)}},
                    {instruction:'שלב 13: עשן',draw:c=>{c.fillStyle='#E6E6FA';c.beginPath();c.arc(246,100,7,0,Math.PI*2);c.arc(243,87,9,0,Math.PI*2);c.arc(251,77,8,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 14: דלת',draw:c=>{c.fillStyle='#654321';c.fillRect(180,227,40,66)}},
                    {instruction:'שלב 15: ידית',draw:c=>{c.fillStyle='#FFD700';c.beginPath();c.arc(210,260,4,0,Math.PI*2);c.fill()}},
                    {instruction:'שלב 16: חלון שמאל',draw:c=>{c.fillStyle='#0FF';c.fillRect(127,207,33,33)}},
                    {instruction:'שלב 17: מסגרת שמאל',draw:c=>{c.strokeStyle='#FFF';c.lineWidth=4;c.strokeRect(127,207,33,33);c.beginPath();c.moveTo(143.5,207);c.lineTo(143.5,240);c.stroke();c.beginPath();c.moveTo(127,223.5);c.lineTo(160,223.5);c.stroke()}},
                    {instruction:'שלב 18: חלון ימין',draw:c=>{c.fillStyle='#FF0';c.fillRect(240,207,33,33)}},
                    {instruction:'שלב 19: מסגרת ימין',draw:c=>{c.strokeStyle='#FFF';c.lineWidth=4;c.strokeRect(240,207,33,33);c.beginPath();c.moveTo(256.5,207);c.lineTo(256.5,240);c.stroke();c.beginPath();c.moveTo(240,223.5);c.lineTo(273,223.5);c.stroke()}},
                    {instruction:'שלב 20: סוכריה שביל 1',draw:c=>{c.fillStyle='#F00';c.beginPath();c.arc(200,313,10,0,Math.PI*2);c.fill();c.strokeStyle='#FFF';c.lineWidth=2;c.stroke()}},
                    {instruction:'שלב 21: סוכריה שביל 2',draw:c=>{c.fillStyle='#0F0';c.beginPath();c.arc(200,333,10,0,Math.PI*2);c.fill();c.strokeStyle='#FFF';c.lineWidth=2;c.stroke()}},
                    {instruction:'שלב 22: סוכריה שביל 3',draw:c=>{c.fillStyle='#00F';c.beginPath();c.arc(200,353,10,0,Math.PI*2);c.fill();c.strokeStyle='#FFF';c.lineWidth=2;c.stroke()}},
                    {instruction:'שלב 23: סוכריה שביל 4',draw:c=>{c.fillStyle='#FF0';c.beginPath();c.arc(200,373,10,0,Math.PI*2);c.fill();c.strokeStyle='#FFF';c.lineWidth=2;c.stroke()}},
                    {instruction:'שלב 24: מקל סוכר שמאל 1',draw:c=>{c.strokeStyle='#F00';c.lineWidth=10;c.lineCap='round';c.beginPath();c.arc(53,240,33,0,Math.PI);c.stroke()}},
                    {instruction:'שלב 25: מקל סוכר שמאל 2',draw:c=>{c.strokeStyle='#FFF';c.lineWidth=10;c.lineCap='round';c.beginPath();c.arc(53,240,33,Math.PI,0);c.stroke()}},
                    {instruction:'שלב 26: מקל סוכר ימין 1',draw:c=>{c.strokeStyle='#F00';c.lineWidth=10;c.lineCap='round';c.beginPath();c.arc(347,253,27,0,Math.PI);c.stroke()}},
                    {instruction:'שלב 27: מקל סוכר ימין 2',draw:c=>{c.strokeStyle='#FFF';c.lineWidth=10;c.lineCap='round';c.beginPath();c.arc(347,253,27,Math.PI,0);c.stroke()}}
                ]
            }
        };
        
        function init() {
            const p = document.getElementById('colorPalette');
            cols.forEach(color => {
                const b = document.createElement('div');
                b.className = 'color-btn' + (color === col ? ' selected' : '');
                b.style.background = color;
                b.setAttribute('data-color', color);
                b.onclick = function() {
                    col = this.getAttribute('data-color');
                    erase = false;
                    document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('drawBtn').classList.add('active');
                    document.getElementById('eraserBtn').classList.remove('active');
                    updCursor();
                };
                p.appendChild(b);
            });
        }
        
        function selectDrawTool() {
            erase = false;
            document.getElementById('drawBtn').classList.add('active');
            document.getElementById('eraserBtn').classList.remove('active');
            updCursor();
        }
        
        function selectEraser() {
            erase = true;
            document.getElementById('eraserBtn').classList.add('active');
            document.getElementById('drawBtn').classList.remove('active');
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('selected'));
            updCursor();
        }
        
        document.getElementById('brushSize').addEventListener('input', (e) => {
            size = parseInt(e.target.value);
            updCursor();
        });
        
        function showMenu() {
            document.getElementById('drawingMenu').classList.remove('hidden');
            document.getElementById('overlay').classList.remove('hidden');
        }
        
        function hideMenu() {
            document.getElementById('drawingMenu').classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
        }
        
        function selectDrawing(n) {
            curr = data[n];
            step = 0;
            exCtx.clearRect(0, 0, 400, 400);
            myCtx.clearRect(0, 0, 400, 400);
            upd();
            hideMenu();
            document.getElementById('nextBtn').disabled = false;
        }
        
        function clearMyCanvas() {
            myCtx.clearRect(0, 0, 400, 400);
        }
        
        function saveDrawing() {
            if (!curr) { 
                alert('בחר ציור תחילה!'); 
                return; 
            }
            const l = document.createElement('a');
            l.download = 'ציור_' + curr.name + '.png';
            l.href = my.toDataURL();
            l.click();
        }
        
        function upd() {
            if (!curr) return;
            exCtx.clearRect(0, 0, 400, 400);
            for (let i = 0; i <= step; i++) curr.steps[i].draw(exCtx);
            document.getElementById('instruction').textContent = curr.steps[step].instruction;
            document.getElementById('stepCounter').textContent = 'שלב ' + (step + 1) + ' מתוך ' + curr.steps.length;
            document.getElementById('prevBtn').disabled = step === 0;
            document.getElementById('nextBtn').disabled = step === curr.steps.length - 1;
        }
        
        function nextStep() {
            if (curr && step < curr.steps.length - 1) { step++; upd(); }
        }
        
        function prevStep() {
            if (step > 0) { step--; upd(); }
        }
        
        my.addEventListener('mousedown', (e) => {
            draw = true;
            const r = my.getBoundingClientRect();
            myCtx.beginPath();
            myCtx.moveTo(e.clientX - r.left, e.clientY - r.top);
        });
        
        my.addEventListener('mousemove', (e) => {
            if (!draw) return;
            const r = my.getBoundingClientRect();
            myCtx.lineCap = 'round';
            myCtx.lineJoin = 'round';
            if (erase) {
                myCtx.globalCompositeOperation = 'destination-out';
                myCtx.lineWidth = size * 2;
            } else {
                myCtx.globalCompositeOperation = 'source-over';
                myCtx.strokeStyle = col;
                myCtx.lineWidth = size;
            }
            myCtx.lineTo(e.clientX - r.left, e.clientY - r.top);
            myCtx.stroke();
        });
        
        my.addEventListener('mouseup', () => { draw = false; });
        my.addEventListener('mouseout', () => { draw = false; });
        
        my.addEventListener('touchstart', (e) => {
            e.preventDefault();
            draw = true;
            const t = e.touches[0];
            const r = my.getBoundingClientRect();
            myCtx.beginPath();
            myCtx.moveTo(t.clientX - r.left, t.clientY - r.top);
        });
        
        my.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!draw) return;
            const t = e.touches[0];
            const r = my.getBoundingClientRect();
            myCtx.lineCap = 'round';
            myCtx.lineJoin = 'round';
            if (erase) {
                myCtx.globalCompositeOperation = 'destination-out';
                myCtx.lineWidth = size * 2;
            } else {
                myCtx.globalCompositeOperation = 'source-over';
                myCtx.strokeStyle = col;
                myCtx.lineWidth = size;
            }
            myCtx.lineTo(t.clientX - r.left, t.clientY - r.top);
            myCtx.stroke();
        });
        
        my.addEventListener('touchend', () => { draw = false; });
        
        init();
    </script>
</body>
</html>
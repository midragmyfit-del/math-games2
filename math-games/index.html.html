<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחקי מתמטיקה כיתה א'</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #fef08a, #fbbf24, #fbcfe8, #c084fc, #93c5fd);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .menu { text-align: center; }
        h1 { font-size: 3rem; color: #7e22ce; margin: 40px 0; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-top: 40px; }
        .game-btn { 
            background: #ec4899; color: white; padding: 40px; border: none; border-radius: 20px;
            font-size: 1.5rem; font-weight: bold; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        .game-btn:hover { transform: scale(1.05); }
        .game-btn.purple { background: #a855f7; }
        .game-btn.blue { background: #3b82f6; }
        .game-icon { font-size: 4rem; margin-bottom: 20px; }
        .game-screen { background: white; padding: 30px; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); display: none; }
        .game-screen.active { display: block; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin: 5px; }
        .btn-back { background: #6b7280; color: white; }
        .btn-restart { background: #10b981; color: white; }
        .score { font-size: 1.5rem; color: #7e22ce; font-weight: bold; }
        .problem { text-align: center; font-size: 3rem; color: #2563eb; font-weight: bold; margin: 30px 0; }
        .game-area { position: relative; height: 500px; background: linear-gradient(180deg, #93c5fd, #bfdbfe); border-radius: 20px; overflow: hidden; border: 4px solid #3b82f6; }
        .balloon { position: absolute; font-size: 5rem; cursor: pointer; transition: transform 0.2s; user-select: none; }
        .balloon:hover { transform: scale(1.1); }
        .balloon-number { position: absolute; top: 33%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; font-weight: bold; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); pointer-events: none; }
        .memory-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
            max-width: 700px; 
            margin: 0 auto;
            padding: 20px;
        }
        .memory-card { 
            width: 100%;
            padding-bottom: 100%;
            position: relative;
            border-radius: 15px; 
            cursor: pointer; 
            transition: all 0.3s; 
            user-select: none;
            overflow: hidden;
        }
        .memory-card-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
        }
        .memory-card:hover { transform: scale(1.05); }
        .memory-card.hidden { background: linear-gradient(135deg, #ec4899, #a855f7); }
        .memory-card.hidden .memory-card-content { color: white; }
        .memory-card.problem { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
        .memory-card.problem .memory-card-content { color: white; }
        .memory-card.answer { background: linear-gradient(135deg, #a78bfa, #7c3aed); }
        .memory-card.answer .memory-card-content { color: white; }
        .memory-card.solved { background: linear-gradient(135deg, #86efac, #22c55e); }
        .memory-card.solved .memory-card-content { color: #166534; }
        .spaceship-area { position: relative; height: 500px; background: linear-gradient(180deg, #1e3a8a, #1e40af, #0c4a6e); border-radius: 20px; overflow: hidden; border: 4px solid #3730a3; }
        .target { position: absolute; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; color: white; border: 4px solid; transition: all 0.3s; }
        .target.orange { background: linear-gradient(135deg, #ea580c, #c2410c); border-color: #7c2d12; }
        .target.green { background: linear-gradient(135deg, #22c55e, #16a34a); border-color: #14532d; }
        .target.red { background: linear-gradient(135deg, #ef4444, #dc2626); border-color: #7f1d1d; }
        .bullet { position: absolute; width: 12px; height: 24px; background: #fbbf24; border-radius: 50%; box-shadow: 0 0 10px #fbbf24; }
        .spaceship { position: absolute; font-size: 4rem; user-select: none; bottom: 5%; }
        .controls { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .control-btn { background: #ec4899; color: white; padding: 15px 30px; border: none; border-radius: 15px; font-size: 1.5rem; font-weight: bold; cursor: pointer; }
        .game-over { text-align: center; padding: 40px; }
        .game-over h2 { font-size: 2.5rem; color: #10b981; margin-bottom: 20px; }
        .game-over p { font-size: 1.5rem; margin: 10px 0; }
        .hint { text-align: center; color: #6b7280; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div id="menu" class="menu">
            <h1>משחקי מתמטיקה כיתה א' 🎮</h1>
            <div class="games-grid">
                <button class="game-btn" onclick="startBalloons()">
                    <div class="game-icon">🎈</div>
                    <div>משחק הבלונים</div>
                </button>
                <button class="game-btn purple" onclick="startMemory()">
                    <div class="game-icon">🧠</div>
                    <div>משחק הזיכרון</div>
                </button>
                <button class="game-btn blue" onclick="startSpaceship()">
                    <div class="game-icon">🚀</div>
                    <div>משחק החללית</div>
                </button>
            </div>
        </div>
        <div id="game"></div>
    </div>

    <script>
        let game = { type: null, score: 0, round: 1, data: {} };
        let timers = [];

        function clearTimers() { timers.forEach(t => clearInterval(t)); timers = []; }
        function sound(f, d) {
            try {
                let c = new AudioContext(), o = c.createOscillator(), g = c.createGain();
                o.connect(g); g.connect(c.destination); o.frequency.value = f;
                g.gain.setValueAtTime(0.1, c.currentTime);
                g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + d);
                o.start(); o.stop(c.currentTime + d);
            } catch(e) {}
        }
        function good() { sound(523, 0.1); setTimeout(() => sound(659, 0.1), 80); }
        function bad() { sound(300, 0.1); }

        function menu() {
            document.getElementById('menu').style.display = 'block';
            document.getElementById('game').innerHTML = '';
            clearTimers();
            game = { type: null, score: 0, round: 1, data: {} };
        }

        function startBalloons() {
            document.getElementById('menu').style.display = 'none';
            game = { type: 'balloon', score: 0, round: 1, correct: 0, wrong: 0, data: { balloons: [], problem: null } };
            newBalloonRound();
            timers.push(setInterval(moveBalloons, 30));
        }

        function newBalloonRound() {
            let n1 = Math.floor(Math.random() * 10) + 1, n2 = Math.floor(Math.random() * 10) + 1;
            let op = Math.random() > 0.5 ? '+' : '-', ans;
            if (op === '-') { if (n1 < n2) { ans = n2 - n1; [n1, n2] = [n2, n1]; } else ans = n1 - n2; }
            else ans = n1 + n2;
            
            game.data.problem = { n1, n2, op, ans };
            let balloons = [{ id: Date.now(), ans, ok: true, x: 25, y: 0, pop: 0 }];
            let used = new Set([ans]);
            
            for (let i = 0; i < 2; i++) {
                let w = ans + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * 5) + 1);
                while (used.has(w) || w < 0) w = ans + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * 5) + 1);
                used.add(w);
                balloons.push({ id: Date.now() + i + 1, ans: w, ok: false, x: 25, y: 0, pop: 0 });
            }
            
            balloons.sort(() => Math.random() - 0.5);
            balloons.forEach((b, i) => b.x = 20 + i * 30);
            game.data.balloons = balloons;
            renderBalloons();
        }

        function renderBalloons() {
            let p = game.data.problem;
            document.getElementById('game').innerHTML = `
                <div class="game-screen active">
                    <div class="header">
                        <button class="btn btn-back" onclick="menu()">חזרה</button>
                        <div class="score">סיבוב: ${game.round}/20 | ניקוד: ${game.score}</div>
                    </div>
                    <div class="problem">? = ${p.n2} ${p.op} ${p.n1}</div>
                    <p class="hint">לחץ על הבלון עם התשובה הנכונה!</p>
                    <div class="game-area" id="area"></div>
                </div>
            `;
            
            let area = document.getElementById('area');
            game.data.balloons.forEach(b => {
                let d = document.createElement('div');
                d.className = 'balloon';
                d.style.left = b.x + '%'; d.style.bottom = b.y + '%';
                if (b.pop === 1) d.innerHTML = '🟢';
                else if (b.pop === 2) d.innerHTML = '🔴';
                else {
                    d.innerHTML = '🎈<div class="balloon-number">' + b.ans + '</div>';
                    d.onclick = () => pop(b.id);
                }
                area.appendChild(d);
            });
        }

        function moveBalloons() {
            if (game.type !== 'balloon') return;
            game.data.balloons.forEach(b => { if (!b.pop) b.y += 0.5; });
            
            let escaped = game.data.balloons.filter(b => b.y >= 95);
            if (escaped.length > 0) {
                if (escaped.some(b => b.ok && !b.pop)) game.wrong++;
                game.data.balloons = game.data.balloons.filter(b => b.y < 95);
                
                if (game.data.balloons.length === 0) {
                    if (game.round < 20) { game.round++; newBalloonRound(); }
                    else endGame('🎈 הניקוד: ' + game.score + '<br>נכון: ' + game.correct + ' | שגוי: ' + game.wrong);
                }
            }
            
            let area = document.getElementById('area');
            if (area) {
                let divs = area.querySelectorAll('.balloon');
                game.data.balloons.forEach((b, i) => { if (divs[i]) divs[i].style.bottom = b.y + '%'; });
            }
        }

        function pop(id) {
            let b = game.data.balloons.find(x => x.id === id);
            if (!b || b.pop) return;
            
            b.pop = b.ok ? 1 : 2;
            sound(800, 0.04);
            renderBalloons();
            
            setTimeout(() => {
                game.data.balloons = game.data.balloons.filter(x => x.id !== id);
                if (b.ok) {
                    game.score += 10; game.correct++;
                    good();
                    setTimeout(() => {
                        if (game.round < 20) { game.round++; newBalloonRound(); }
                        else endGame('🎈 הניקוד: ' + game.score + '<br>נכון: ' + game.correct + ' | שגוי: ' + game.wrong);
                    }, 500);
                } else {
                    game.score = Math.max(0, game.score - 5); game.wrong++;
                    bad();
                    renderBalloons();
                }
            }, 300);
        }

        function startMemory() {
            document.getElementById('menu').style.display = 'none';
            game = { type: 'memory', score: 0, round: 1, data: { cards: [], flip: [], solved: [], moves: 0, lock: false } };
            newMemoryRound();
        }

        function newMemoryRound() {
            let probs = [], used = new Set();
            while (probs.length < 8) {
                let n1 = Math.floor(Math.random() * 5) + 1, n2 = Math.floor(Math.random() * 5) + 1;
                let op = Math.random() > 0.5 ? '+' : '-', ans, txt;
                if (op === '-') { if (n1 < n2) { ans = n2 - n1; txt = n1 + ' - ' + n2; } else { ans = n1 - n2; txt = n2 + ' - ' + n1; } }
                else { ans = n1 + n2; txt = n2 + ' + ' + n1; }
                if (!used.has(ans) && ans >= 0) { used.add(ans); probs.push({ txt, ans }); }
            }
            
            let cards = [];
            probs.forEach((p, i) => {
                cards.push({ id: i * 2, type: 'p', txt: p.txt, m: i });
                cards.push({ id: i * 2 + 1, type: 'a', txt: p.ans + '', m: i });
            });
            cards.sort(() => Math.random() - 0.5);
            game.data = { cards, flip: [], solved: [], moves: 0, lock: false };
            renderMemory();
        }

        function renderMemory() {
            let d = game.data;
            document.getElementById('game').innerHTML = `
                <div class="game-screen active">
                    <div class="header">
                        <button class="btn btn-back" onclick="menu()">חזרה</button>
                        <div class="score">סיבוב: ${game.round}/20 | ניקוד: ${game.score}</div>
                    </div>
                    <h2 style="text-align: center; color: #2563eb; margin-bottom: 15px;">התאם את הבעיות לתשובות!</h2>
                    <p class="hint">מהלכים: ${d.moves}</p>
                    <div class="memory-grid" id="grid"></div>
                </div>
            `;
            
            let grid = document.getElementById('grid');
            d.cards.forEach(c => {
                let div = document.createElement('div');
                div.className = 'memory-card';
                
                let content = document.createElement('div');
                content.className = 'memory-card-content';
                
                let isFlip = d.flip.includes(c.id), isSolved = d.solved.includes(c.m);
                
                if (isSolved) { 
                    div.classList.add('solved'); 
                    content.textContent = c.txt; 
                }
                else if (isFlip) { 
                    div.classList.add(c.type === 'p' ? 'problem' : 'answer'); 
                    content.textContent = c.txt; 
                }
                else { 
                    div.classList.add('hidden'); 
                    content.textContent = '❓'; 
                    div.onclick = () => flipCard(c.id); 
                }
                
                div.appendChild(content);
                grid.appendChild(div);
            });
            
            if (d.solved.length === 8) {
                setTimeout(() => {
                    if (game.round < 20) { game.round++; newMemoryRound(); }
                    else endGame('🧠 הניקוד: ' + game.score);
                }, 1500);
            }
        }

        function flipCard(id) {
            let d = game.data;
            if (d.lock || d.flip.length === 2) return;
            let c = d.cards.find(x => x.id === id);
            if (!c || d.flip.includes(id) || d.solved.includes(c.m)) return;
            
            sound(600, 0.05);
            d.flip.push(id);
            renderMemory();
            
            if (d.flip.length === 2) {
                d.lock = true; d.moves++;
                let c1 = d.cards.find(x => x.id === d.flip[0]), c2 = d.cards.find(x => x.id === d.flip[1]);
                
                if (c1.m === c2.m) {
                    sound(523, 0.1);
                    setTimeout(() => {
                        d.solved.push(c1.m); d.flip = []; d.lock = false;
                        if (d.solved.length === 8) { game.score += Math.max(50 - d.moves * 2, 10); good(); }
                        renderMemory();
                    }, 600);
                } else {
                    bad();
                    setTimeout(() => { d.flip = []; d.lock = false; renderMemory(); }, 1000);
                }
            }
        }

        function startSpaceship() {
            document.getElementById('menu').style.display = 'none';
            game = { type: 'ship', score: 0, round: 1, correct: 0, wrong: 0, data: { pos: 45, bullets: [], targets: [], hit: {}, problem: null, keys: {} } };
            newShipRound();
            document.addEventListener('keydown', shipKey);
            document.addEventListener('keyup', e => { if (game.type === 'ship') game.data.keys[e.key] = false; });
            timers.push(setInterval(moveShip, 30));
        }

        function newShipRound() {
            let n1 = Math.floor(Math.random() * 10) + 1, n2 = Math.floor(Math.random() * 10) + 1;
            let op = Math.random() > 0.5 ? '+' : '-', ans;
            if (op === '-') { if (n1 < n2) { ans = n2 - n1; [n1, n2] = [n2, n1]; } else ans = n1 - n2; }
            else ans = n1 + n2;
            
            game.data.problem = { n1, n2, op, ans };
            let idx = Math.floor(Math.random() * 5), targets = [], used = new Set([ans]);
            
            for (let i = 0; i < 5; i++) {
                if (i === idx) targets.push({ v: ans, ok: true });
                else {
                    let w = ans + (i - 2);
                    while (used.has(w) || w < 0) w = ans + Math.floor(Math.random() * 10) - 5;
                    if (w < 0) w = ans + i + 1;
                    used.add(w);
                    targets.push({ v: w, ok: false });
                }
            }
            
            game.data.targets = targets;
            game.data.hit = {};
            renderShip();
        }

        function shipKey(e) {
            if (game.type !== 'ship') return;
            game.data.keys[e.key] = true;
            if (e.key === ' ') { e.preventDefault(); shoot(); }
        }

        function shoot() {
            game.data.bullets.push({ id: Date.now(), x: game.data.pos, y: 82 });
            sound(1200, 0.03);
        }

        function moveShip() {
            if (game.type !== 'ship') return;
            let d = game.data;
            if (d.keys['ArrowLeft']) d.pos = Math.max(0, d.pos - 2);
            if (d.keys['ArrowRight']) d.pos = Math.min(88, d.pos + 2);
            
            d.bullets = d.bullets.map(b => ({ ...b, y: b.y - 2.5 })).filter(b => b.y > -5);
            
            let tpos = [10, 27, 44, 61, 78];
            d.bullets.forEach(b => {
                tpos.forEach((tx, i) => {
                    if (d.hit[i]) return;
                    if (Math.abs(b.x - tx) < 10 && Math.abs(b.y - 20) < 12) {
                        d.bullets = d.bullets.filter(x => x.id !== b.id);
                        
                        if (d.targets[i].ok) {
                            d.hit[i] = 'g';
                            game.score += 10; game.correct++;
                            sound(200, 0.08);
                            good();
                            setTimeout(() => {
                                if (game.round < 20) { game.round++; newShipRound(); }
                                else endGame('🚀 הניקוד: ' + game.score + '<br>נכון: ' + game.correct + ' | שגוי: ' + game.wrong);
                            }, 1000);
                        } else {
                            d.hit[i] = 'r';
                            game.score = Math.max(0, game.score - 3); game.wrong++;
                            sound(200, 0.08);
                            setTimeout(() => bad(), 100);
                        }
                        renderShip();
                    }
                });
            });
            
            let ship = document.getElementById('ship');
            if (ship) ship.style.left = 'calc(' + d.pos + '% - 30px)';
            
            let area = document.getElementById('area');
            if (area) {
                let old = area.querySelectorAll('.bullet');
                old.forEach(e => e.remove());
                d.bullets.forEach(b => {
                    let div = document.createElement('div');
                    div.className = 'bullet';
                    div.style.left = 'calc(' + b.x + '% - 6px)';
                    div.style.top = b.y + '%';
                    area.appendChild(div);
                });
            }
        }

        function renderShip() {
            let d = game.data, p = d.problem;
            let tpos = [10, 27, 44, 61, 78];
            
            document.getElementById('game').innerHTML = `
                <div class="game-screen active">
                    <div class="header">
                        <button class="btn btn-back" onclick="menu()">חזרה</button>
                        <div class="score">סיבוב: ${game.round}/20 | ניקוד: ${game.score}</div>
                    </div>
                    <div class="problem">? = ${p.n2} ${p.op} ${p.n1}</div>
                    <p class="hint">ירה על המטרה הנכונה! (חצים + רווח)</p>
                    <div class="spaceship-area" id="area">
                        ${d.targets.map((t, i) => {
                            let cls = d.hit[i] === 'g' ? 'green' : d.hit[i] === 'r' ? 'red' : 'orange';
                            return `<div class="target ${cls}" style="left: calc(${tpos[i]}% - 40px); top: 20%;">${t.v}</div>`;
                        }).join('')}
                        <div id="ship" class="spaceship" style="left: calc(${d.pos}% - 30px);">🚀</div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="game.data.pos = Math.max(0, game.data.pos - 5); renderShip();">→</button>
                        <button class="control-btn" onclick="shoot();">ירה! 🔥</button>
                        <button class="control-btn" onclick="game.data.pos = Math.min(88, game.data.pos + 5); renderShip();">←</button>
                    </div>
                </div>
            `;
        }

        function endGame(msg) {
            clearTimers();
            document.getElementById('game').innerHTML = `
                <div class="game-screen active">
                    <div class="game-over">
                        <h2>המשחק הסתיים! 🎉</h2>
                        <p style="font-size: 2rem; color: #7e22ce; font-weight: bold;">${msg}</p>
                        <div style="margin-top: 30px;">
                            <button class="btn btn-restart" onclick="${game.type === 'balloon' ? 'startBalloons()' : game.type === 'memory' ? 'startMemory()' : 'startSpaceship()'}">שחק שוב</button>
                            <button class="btn btn-back" onclick="menu()">חזרה לתפריט</button>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
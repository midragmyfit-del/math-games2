<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>למד לצייר יצורים קסומים</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .title {
            text-align: center;
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            flex-wrap: wrap;
            justify-content: center;
        }
        .canvas-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 300px;
        }
        .canvas-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }
        canvas {
            border: 3px solid #667eea;
            border-radius: 15px;
            cursor: none;
            display: block;
            margin: 0 auto;
            background: white;
        }
        #cursor {
            position: fixed;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #000, inset 0 0 0 2px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            display: none;
            transform: translate(-50%, -50%);
        }
        #cursor::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1px;
            height: 10px;
            background: #000;
            box-shadow: 1px 0 0 #fff, -1px 0 0 #fff;
        }
        #cursor::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 1px;
            background: #000;
            box-shadow: 0 1px 0 #fff, 0 -1px 0 #fff;
        }
        .controls {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .control-section { text-align: center; }
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .instruction-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .step-counter {
            font-size: 1.1em;
            color: #666;
            margin-top: 10px;
        }
        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        .nav-buttons { display: flex; gap: 10px; }
        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            justify-items: center;
        }
        .color-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }
        .color-btn:hover { transform: scale(1.2); }
        .color-btn.selected {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            transform: scale(1.2);
        }
        .tool-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 10px;
        }
        .tool-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s;
        }
        .tool-btn:hover { transform: scale(1.1); }
        .tool-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        .drawing-menu {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            max-width: 600px;
            width: 90%;
        }
        .drawing-menu.hidden { display: none; }
        .menu-title {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .drawing-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .drawing-option {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .drawing-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: #667eea;
        }
        .drawing-icon { font-size: 3em; margin-bottom: 10px; }
        .drawing-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        .difficulty-stars {
            color: #FFD700;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .overlay.hidden { display: none; }
        .size-slider { width: 100%; margin: 10px 0; }
    </style>
</head>
<body>
    <div id="cursor"></div>
    <div class="overlay hidden" id="overlay"></div>
    
    <div class="drawing-menu" id="drawingMenu">
        <div class="menu-title">✨ בחר יצור קסום לצייר</div>
        <div class="drawing-options">
            <div class="drawing-option" onclick="selectDrawing('ghost')">
                <div class="drawing-icon">👻</div>
                <div class="drawing-name">רוח רפאים</div>
                <div class="difficulty-stars">★★☆☆☆</div>
            </div>
            <div class="drawing-option" onclick="selectDrawing('pumpkin')">
                <div class="drawing-icon">🎃</div>
                <div class="drawing-name">דלעת</div>
                <div class="difficulty-stars">★★★☆☆</div>
            </div>
            <div class="drawing-option" onclick="selectDrawing('dragon')">
                <div class="drawing-icon">🐉</div>
                <div class="drawing-name">דרקון</div>
                <div class="difficulty-stars">★★★★☆</div>
            </div>
            <div class="drawing-option" onclick="selectDrawing('mermaid')">
                <div class="drawing-icon">🧜‍♀️</div>
                <div class="drawing-name">בת ים</div>
                <div class="difficulty-stars">★★★★☆</div>
            </div>
        </div>
    </div>
    
    <div class="title">✨ למד לצייר יצורים קסומים - שלב אחר שלב! 🎨</div>
    
    <div class="main-container">
        <div class="canvas-container">
            <div class="canvas-title">הדוגמה - עקוב אחרי השלבים 👀</div>
            <canvas id="exampleCanvas" width="400" height="400"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-section">
                <div class="instruction-box" id="instruction">בחר יצור קסום מהתפריט כדי להתחיל!</div>
                <div class="step-counter" id="stepCounter"></div>
            </div>
            
            <div class="control-section">
                <div class="section-title">כלים 🛠️</div>
                <div class="tool-buttons">
                    <button class="tool-btn active" id="drawBtn" onclick="selectDrawTool()">✏️ עט</button>
                    <button class="tool-btn" id="eraserBtn" onclick="selectEraser()">🧹 מחק</button>
                </div>
            </div>
            
            <div class="control-section">
                <div class="section-title">צבעים 🎨</div>
                <div class="color-palette" id="colorPalette"></div>
            </div>
            
            <div class="control-section">
                <div class="section-title">עובי מכחול</div>
                <input type="range" class="size-slider" id="brushSize" min="2" max="15" value="5">
            </div>
            
            <div class="control-section">
                <div class="nav-buttons">
                    <button class="button" id="prevBtn" onclick="prevStep()" disabled>⬅️ קודם</button>
                    <button class="button" id="nextBtn" onclick="nextStep()" disabled>הבא ➡️</button>
                </div>
            </div>
            
            <button class="button" onclick="clearMyCanvas()">🗑️ נקה את הציור שלי</button>
            <button class="button" onclick="saveDrawing()">💾 שמור את הציור שלי</button>
            <button class="button" onclick="showMenu()">🎨 בחר ציור אחר</button>
        </div>
        
        <div class="canvas-container">
            <div class="canvas-title">הציור שלך - צייר כאן! ✏️</div>
            <canvas id="myCanvas" width="400" height="400"></canvas>
        </div>
    </div>

    <script>
        var ex = document.getElementById('exampleCanvas');
        var my = document.getElementById('myCanvas');
        var exCtx = ex.getContext('2d');
        var myCtx = my.getContext('2d');
        var cursor = document.getElementById('cursor');
        
        var curr = null;
        var step = 0;
        var draw = false;
        var col = '#000000';
        var size = 5;
        var erase = false;
        
        function updCursor() {
            var s = erase ? size * 4 : size * 2;
            cursor.style.width = s + 'px';
            cursor.style.height = s + 'px';
            if (erase) {
                cursor.style.borderColor = '#fff';
                cursor.style.boxShadow = '0 0 0 2px #ff0000, inset 0 0 0 2px #ff0000';
            } else {
                cursor.style.borderColor = '#fff';
                cursor.style.boxShadow = '0 0 0 2px #000, inset 0 0 0 2px ' + col;
            }
        }
        
        my.addEventListener('mouseenter', function() {
            cursor.style.display = 'block';
            updCursor();
        });
        
        my.addEventListener('mouseleave', function() {
            cursor.style.display = 'none';
        });
        
        my.addEventListener('mousemove', function(e) {
            cursor.style.left = e.pageX + 'px';
            cursor.style.top = e.pageY + 'px';
        });
        
        var cols = [
            '#000000','#FFFFFF','#FF0000','#00FF00','#0000FF',
            '#FFFF00','#FFA500','#800080','#FF00FF','#00FFFF',
            '#FFC0CB','#00BFFF','#87CEEB','#FFD700','#FF69B4',
            '#FF1493','#8B4513','#FFE4B5','#FFDAB9','#8B0000',
            '#DC143C','#006400','#228B22','#90EE90','#FF6347'
        ];
        
        var data = {
            ghost: {
                name: 'רוח רפאים חמודה',
                steps: [
                    { instruction: 'שלב 1: רקע לילה - שחור', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.fillRect(0, 0, 400, 400);
                    }},
                    { instruction: 'שלב 2: ירח צהוב גדול', draw: function(c){ 
                        c.fillStyle = '#FFFF00';
                        c.beginPath();
                        c.arc(320, 80, 40, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 3: כוכב 1 - למעלה משמאל', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        for (var i = 0; i < 5; i++) {
                            var angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                            var x = 60 + Math.cos(angle) * 8;
                            var y = 60 + Math.sin(angle) * 8;
                            if (i === 0) c.moveTo(x, y);
                            else c.lineTo(x, y);
                        }
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 4: כוכב 2 - מעל הרוח רפאים', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        for (var i = 0; i < 5; i++) {
                            var angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                            var x = 200 + Math.cos(angle) * 8;
                            var y = 40 + Math.sin(angle) * 8;
                            if (i === 0) c.moveTo(x, y);
                            else c.lineTo(x, y);
                        }
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 5: כוכב 3 - צד ימין', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        for (var i = 0; i < 5; i++) {
                            var angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                            var x = 340 + Math.cos(angle) * 8;
                            var y = 160 + Math.sin(angle) * 8;
                            if (i === 0) c.moveTo(x, y);
                            else c.lineTo(x, y);
                        }
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 6: גוף הרוח - חלק עליון עגול', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(200, 180, 65, Math.PI, 0);
                        c.fill();
                    }},
                    { instruction: 'שלב 7: גוף הרוח - ממשיכים למטה', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.fillRect(135, 180, 130, 80);
                    }},
                    { instruction: 'שלב 8: גל ראשון בתחתית - שמאל', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.moveTo(135, 260);
                        c.quadraticCurveTo(145, 280, 155, 270);
                        c.lineTo(155, 260);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 9: גל שני', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.moveTo(155, 260);
                        c.lineTo(155, 270);
                        c.quadraticCurveTo(170, 285, 185, 270);
                        c.lineTo(185, 260);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 10: גל שלישי - באמצע', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.moveTo(185, 260);
                        c.lineTo(185, 270);
                        c.quadraticCurveTo(200, 290, 215, 270);
                        c.lineTo(215, 260);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 11: גל רביעי', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.moveTo(215, 260);
                        c.lineTo(215, 270);
                        c.quadraticCurveTo(230, 285, 245, 270);
                        c.lineTo(245, 260);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 12: גל חמישי - ימין', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.moveTo(245, 260);
                        c.lineTo(245, 270);
                        c.quadraticCurveTo(255, 280, 265, 260);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 13: עין שמאלית - אליפסה שחורה', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.ellipse(175, 190, 15, 23, 0, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 14: עין ימנית - אליפסה שחורה', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.ellipse(225, 190, 15, 23, 0, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 15: ניצוץ לבן בעין שמאלית', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(180, 185, 6, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 16: ניצוץ לבן בעין ימנית', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(230, 185, 6, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 17: לחיים ורודות', draw: function(c){ 
                        c.fillStyle = '#FFC0CB';
                        c.beginPath();
                        c.arc(155, 210, 12, 0, Math.PI * 2);
                        c.fill();
                        c.beginPath();
                        c.arc(245, 210, 12, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 18: חיוך גדול - קשת שחורה', draw: function(c){ 
                        c.strokeStyle = '#000000';
                        c.lineWidth = 4;
                        c.beginPath();
                        c.arc(200, 215, 28, 0.2, Math.PI - 0.2);
                        c.stroke();
                    }},
                    { instruction: 'שלב 19: יד שמאלית - עיגול לבן', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.ellipse(120, 220, 15, 22, -0.3, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 20: יד ימנית - עיגול לבן', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.ellipse(280, 220, 15, 22, 0.3, 0, Math.PI * 2);
                        c.fill();
                    }}
                ]
            },
            pumpkin: {
                name: 'דלעת מחייכת',
                steps: [
                    { instruction: 'שלב 1: רקע כתום בהיר', draw: function(c){ 
                        c.fillStyle = '#FFA500';
                        c.fillRect(0, 0, 400, 400);
                    }},
                    { instruction: 'שלב 2: אדמה חומה למטה', draw: function(c){ 
                        c.fillStyle = '#8B4513';
                        c.fillRect(0, 320, 400, 80);
                    }},
                    { instruction: 'שלב 3: חלק מרכזי של הדלעת', draw: function(c){ 
                        c.fillStyle = '#FF8C00';
                        c.beginPath();
                        c.ellipse(200, 213, 45, 65, 0, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 4: חלק שמאל פנימי', draw: function(c){ 
                        c.fillStyle = '#FF8C00';
                        c.beginPath();
                        c.ellipse(160, 220, 38, 60, -0.15, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 5: חלק שמאל חיצוני', draw: function(c){ 
                        c.fillStyle = '#FF8C00';
                        c.beginPath();
                        c.ellipse(125, 227, 30, 55, -0.3, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 6: חלק ימין פנימי', draw: function(c){ 
                        c.fillStyle = '#FF8C00';
                        c.beginPath();
                        c.ellipse(240, 220, 38, 60, 0.15, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 7: חלק ימין חיצוני', draw: function(c){ 
                        c.fillStyle = '#FF8C00';
                        c.beginPath();
                        c.ellipse(275, 227, 30, 55, 0.3, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 8: קווי חלוקה - 5 קווים חומים', draw: function(c){ 
                        c.strokeStyle = '#8B4513';
                        c.lineWidth = 4;
                        for (var i = 0; i < 5; i++) {
                            c.beginPath();
                            var x = 125 + i * 37;
                            c.moveTo(x, 165);
                            c.quadraticCurveTo(x + (i < 2 ? -8 : i > 2 ? 8 : 0), 213, x, 280);
                            c.stroke();
                        }
                    }},
                    { instruction: 'שלב 9: עוקץ - מלבן חום', draw: function(c){ 
                        c.fillStyle = '#8B4513';
                        c.fillRect(193, 133, 14, 35);
                    }},
                    { instruction: 'שלב 10: חלק עליון מעוגל של העוקץ', draw: function(c){ 
                        c.fillStyle = '#8B4513';
                        c.beginPath();
                        c.arc(200, 133, 7, Math.PI, 0);
                        c.fill();
                    }},
                    { instruction: 'שלב 11: עלה ירוק על העוקץ', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.beginPath();
                        c.ellipse(213, 145, 10, 18, 0.6, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 12: עורק בעלה - קו ירוק כהה', draw: function(c){ 
                        c.strokeStyle = '#006400';
                        c.lineWidth = 2;
                        c.beginPath();
                        c.moveTo(210, 135);
                        c.lineTo(215, 155);
                        c.stroke();
                    }},
                    { instruction: 'שלב 13: עין שמאלית - משולש שחור', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.moveTo(160, 193);
                        c.lineTo(150, 218);
                        c.lineTo(170, 218);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 14: עין ימנית - משולש שחור', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.moveTo(240, 193);
                        c.lineTo(230, 218);
                        c.lineTo(250, 218);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 15: אף - משולש שחור', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.moveTo(200, 228);
                        c.lineTo(193, 248);
                        c.lineTo(207, 248);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 16: פה משונן - חלק עליון', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.moveTo(145, 258);
                        c.lineTo(160, 253);
                        c.lineTo(175, 258);
                        c.lineTo(190, 253);
                        c.lineTo(205, 258);
                        c.lineTo(220, 253);
                        c.lineTo(255, 258);
                        c.lineTo(255, 268);
                        c.lineTo(145, 268);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 17: שיניים לבנות - 4 שיניים', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        for (var i = 0; i < 4; i++) {
                            c.fillRect(155 + i * 25, 258, 15, 10);
                        }
                    }}
                ]
            },
            dragon: {
                name: 'דרקון ידידותי',
                steps: [
                    { instruction: 'שלב 1: שמיים כחולים', draw: function(c){ 
                        c.fillStyle = '#87CEEB';
                        c.fillRect(0, 0, 400, 400);
                    }},
                    { instruction: 'שלב 2: דשא ירוק', draw: function(c){ 
                        c.fillStyle = '#90EE90';
                        c.fillRect(0, 300, 400, 100);
                    }},
                    { instruction: 'שלב 3: זנב - אליפסה ירוקה', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.beginPath();
                        c.ellipse(100, 253, 25, 40, -0.5, 0, Math.PI * 2);
                        c.fill();
                        c.strokeStyle = '#006400';
                        c.lineWidth = 2;
                        c.stroke();
                    }},
                    { instruction: 'שלב 4: קוץ זהוב על הזנב', draw: function(c){ 
                        c.fillStyle = '#FFD700';
                        c.beginPath();
                        c.moveTo(90, 240);
                        c.lineTo(80, 225);
                        c.lineTo(95, 235);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 5: גוף - אליפסה ירוקה גדולה', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.beginPath();
                        c.ellipse(180, 250, 60, 45, 0, 0, Math.PI * 2);
                        c.fill();
                        c.strokeStyle = '#006400';
                        c.lineWidth = 3;
                        c.stroke();
                    }},
                    { instruction: 'שלב 6: קשקשים ירוקים בהירים על הגוף', draw: function(c){ 
                        c.fillStyle = '#90EE90';
                        var scales = [[150, 240], [170, 235], [190, 235], [210, 240], [160, 255], [180, 250], [200, 255]];
                        scales.forEach(function(pos) {
                            c.beginPath();
                            c.arc(pos[0], pos[1], 6, 0, Math.PI * 2);
                            c.fill();
                        });
                    }},
                    { instruction: 'שלב 7: רגל אחורית', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.fillRect(150, 285, 18, 30);
                        c.beginPath();
                        c.ellipse(159, 315, 12, 8, 0, 0, Math.PI);
                        c.fill();
                    }},
                    { instruction: 'שלב 8: רגל קדמית', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.fillRect(210, 285, 18, 30);
                        c.beginPath();
                        c.ellipse(219, 315, 12, 8, 0, 0, Math.PI);
                        c.fill();
                    }},
                    { instruction: 'שלב 9: כנף שמאלית - צורת עלה אדומה', draw: function(c){ 
                        c.fillStyle = '#FF0000';
                        c.beginPath();
                        c.moveTo(160, 230);
                        c.quadraticCurveTo(120, 200, 100, 220);
                        c.quadraticCurveTo(130, 230, 160, 240);
                        c.closePath();
                        c.fill();
                        c.strokeStyle = '#8B0000';
                        c.lineWidth = 2;
                        c.stroke();
                    }},
                    { instruction: 'שלב 10: פרטי כנף - 2 קווים', draw: function(c){ 
                        c.strokeStyle = '#8B0000';
                        c.lineWidth = 2;
                        c.beginPath();
                        c.moveTo(160, 235);
                        c.lineTo(120, 215);
                        c.stroke();
                        c.beginPath();
                        c.moveTo(155, 238);
                        c.lineTo(105, 225);
                        c.stroke();
                    }},
                    { instruction: 'שלב 11: כנף ימנית - צורת עלה אדומה', draw: function(c){ 
                        c.fillStyle = '#FF0000';
                        c.beginPath();
                        c.moveTo(200, 230);
                        c.quadraticCurveTo(240, 200, 260, 220);
                        c.quadraticCurveTo(230, 230, 200, 240);
                        c.closePath();
                        c.fill();
                        c.strokeStyle = '#8B0000';
                        c.lineWidth = 2;
                        c.stroke();
                    }},
                    { instruction: 'שלב 12: פרטי כנף ימנית - 2 קווים', draw: function(c){ 
                        c.strokeStyle = '#8B0000';
                        c.lineWidth = 2;
                        c.beginPath();
                        c.moveTo(200, 235);
                        c.lineTo(240, 215);
                        c.stroke();
                        c.beginPath();
                        c.moveTo(205, 238);
                        c.lineTo(255, 225);
                        c.stroke();
                    }},
                    { instruction: 'שלב 13: צוואר - מלבן ירוק', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.fillRect(230, 210, 25, 35);
                    }},
                    { instruction: 'שלב 14: ראש - עיגול ירוק', draw: function(c){ 
                        c.fillStyle = '#228B22';
                        c.beginPath();
                        c.ellipse(243, 195, 28, 25, 0, 0, Math.PI * 2);
                        c.fill();
                        c.strokeStyle = '#006400';
                        c.lineWidth = 2;
                        c.stroke();
                    }},
                    { instruction: 'שלב 15: קרן שמאלית - משולש זהוב', draw: function(c){ 
                        c.fillStyle = '#FFD700';
                        c.beginPath();
                        c.moveTo(228, 178);
                        c.lineTo(222, 163);
                        c.lineTo(233, 173);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 16: קרן ימנית - משולש זהוב', draw: function(c){ 
                        c.fillStyle = '#FFD700';
                        c.beginPath();
                        c.moveTo(258, 178);
                        c.lineTo(264, 163);
                        c.lineTo(253, 173);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 17: עין שמאלית - לבן ושחור', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(235, 192, 6, 0, Math.PI * 2);
                        c.fill();
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.arc(236, 193, 3, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 18: עין ימנית - לבן ושחור', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(251, 192, 6, 0, Math.PI * 2);
                        c.fill();
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.arc(252, 193, 3, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 19: חיוך חמוד', draw: function(c){ 
                        c.strokeStyle = '#000000';
                        c.lineWidth = 2;
                        c.beginPath();
                        c.arc(243, 203, 10, 0.2, Math.PI - 0.2);
                        c.stroke();
                    }},
                    { instruction: 'שלב 20: אש מהפה - משולש אדום', draw: function(c){ 
                        c.fillStyle = '#FF0000';
                        c.beginPath();
                        c.moveTo(268, 200);
                        c.lineTo(295, 195);
                        c.lineTo(285, 208);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 21: אש כתומה בתוך האדומה', draw: function(c){ 
                        c.fillStyle = '#FFA500';
                        c.beginPath();
                        c.moveTo(273, 200);
                        c.lineTo(288, 198);
                        c.lineTo(282, 206);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 22: אש צהובה בתוך הכתומה', draw: function(c){ 
                        c.fillStyle = '#FFFF00';
                        c.beginPath();
                        c.moveTo(278, 200);
                        c.lineTo(285, 200);
                        c.lineTo(282, 204);
                        c.closePath();
                        c.fill();
                    }}
                ]
            },
            mermaid: {
                name: 'בת ים',
                steps: [
                    { instruction: 'שלב 1: רקע מים כחול', draw: function(c){ 
                        c.fillStyle = '#0000FF';
                        c.fillRect(0, 0, 400, 400);
                    }},
                    { instruction: 'שלב 2: בועה 1 - כחולה בהירה', draw: function(c){ 
                        c.fillStyle = '#87CEEB';
                        c.beginPath();
                        c.arc(80, 100, 12, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 3: בועה 2 - למעלה מימין', draw: function(c){ 
                        c.fillStyle = '#87CEEB';
                        c.beginPath();
                        c.arc(320, 80, 12, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 4: בועה 3 - למטה משמאל', draw: function(c){ 
                        c.fillStyle = '#87CEEB';
                        c.beginPath();
                        c.arc(60, 280, 12, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 5: בועה 4 - למטה מימין', draw: function(c){ 
                        c.fillStyle = '#87CEEB';
                        c.beginPath();
                        c.arc(340, 300, 12, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 6: זנב עליון - טורקיז', draw: function(c){ 
                        c.fillStyle = '#00FFFF';
                        c.beginPath();
                        c.moveTo(200, 240);
                        c.quadraticCurveTo(180, 280, 185, 320);
                        c.quadraticCurveTo(200, 315, 200, 330);
                        c.quadraticCurveTo(200, 315, 215, 320);
                        c.quadraticCurveTo(220, 280, 200, 240);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 7: סנפיר זנב שמאלי', draw: function(c){ 
                        c.fillStyle = '#00FFFF';
                        c.beginPath();
                        c.moveTo(185, 320);
                        c.quadraticCurveTo(170, 345, 160, 360);
                        c.quadraticCurveTo(180, 350, 200, 330);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 8: סנפיר זנב ימני', draw: function(c){ 
                        c.fillStyle = '#00FFFF';
                        c.beginPath();
                        c.moveTo(215, 320);
                        c.quadraticCurveTo(230, 345, 240, 360);
                        c.quadraticCurveTo(220, 350, 200, 330);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 9: קשקשים זהובים על הזנב - 6 עיגולים', draw: function(c){ 
                        c.fillStyle = '#FFD700';
                        var scales = [[190, 260], [210, 260], [188, 280], [212, 280], [192, 300], [208, 300]];
                        scales.forEach(function(pos) {
                            c.beginPath();
                            c.arc(pos[0], pos[1], 5, 0, Math.PI * 2);
                            c.fill();
                        });
                    }},
                    { instruction: 'שלב 10: גוף עליון - מלבן בצבע עור', draw: function(c){ 
                        c.fillStyle = '#FFDAB9';
                        c.fillRect(180, 180, 40, 65);
                    }},
                    { instruction: 'שלב 11: יד שמאלית', draw: function(c){ 
                        c.fillStyle = '#FFDAB9';
                        c.beginPath();
                        c.moveTo(180, 195);
                        c.quadraticCurveTo(155, 205, 150, 225);
                        c.lineTo(155, 228);
                        c.quadraticCurveTo(160, 210, 183, 200);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 12: יד ימנית', draw: function(c){ 
                        c.fillStyle = '#FFDAB9';
                        c.beginPath();
                        c.moveTo(220, 195);
                        c.quadraticCurveTo(245, 205, 250, 225);
                        c.lineTo(245, 228);
                        c.quadraticCurveTo(240, 210, 217, 200);
                        c.closePath();
                        c.fill();
                    }},
                    { instruction: 'שלב 13: חזייה מצדפים - 2 חצאי עיגולים ורודים', draw: function(c){ 
                        c.fillStyle = '#FF69B4';
                        c.beginPath();
                        c.arc(190, 200, 13, 0, Math.PI);
                        c.fill();
                        c.beginPath();
                        c.arc(210, 200, 13, 0, Math.PI);
                        c.fill();
                    }},
                    { instruction: 'שלב 14: ראש - עיגול בצבע עור', draw: function(c){ 
                        c.fillStyle = '#FFDAB9';
                        c.beginPath();
                        c.arc(200, 155, 25, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 15: שיער - חצי עיגול חום', draw: function(c){ 
                        c.fillStyle = '#8B4513';
                        c.beginPath();
                        c.arc(200, 140, 27, Math.PI, 0);
                        c.fill();
                    }},
                    { instruction: 'שלב 16: תלתל שמאלי', draw: function(c){ 
                        c.fillStyle = '#8B4513';
                        c.beginPath();
                        c.arc(178, 150, 15, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 17: תלתל ימני', draw: function(c){ 
                        c.fillStyle = '#8B4513';
                        c.beginPath();
                        c.arc(222, 150, 15, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 18: פרח בשיער - 5 עלי כותרת ורודים', draw: function(c){ 
                        c.fillStyle = '#FF69B4';
                        for (var i = 0; i < 5; i++) {
                            var angle = (i * 2 * Math.PI) / 5;
                            c.beginPath();
                            c.arc(
                                220 + Math.cos(angle) * 8,
                                140 + Math.sin(angle) * 8,
                                5, 0, Math.PI * 2
                            );
                            c.fill();
                        }
                    }},
                    { instruction: 'שלב 19: מרכז הפרח - עיגול צהוב', draw: function(c){ 
                        c.fillStyle = '#FFD700';
                        c.beginPath();
                        c.arc(220, 140, 4, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 20: עין שמאלית - שחורה', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.arc(192, 153, 5, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 21: עין ימנית - שחורה', draw: function(c){ 
                        c.fillStyle = '#000000';
                        c.beginPath();
                        c.arc(208, 153, 5, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 22: ניצוץ לבן בעיניים', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(193, 152, 2, 0, Math.PI * 2);
                        c.fill();
                        c.beginPath();
                        c.arc(209, 152, 2, 0, Math.PI * 2);
                        c.fill();
                    }},
                    { instruction: 'שלב 23: חיוך - קשת ורודה', draw: function(c){ 
                        c.strokeStyle = '#FF69B4';
                        c.lineWidth = 2;
                        c.beginPath();
                        c.arc(200, 162, 10, 0.2, Math.PI - 0.2);
                        c.stroke();
                    }},
                    { instruction: 'שלב 24: צדפה ביד - חצי עיגול ורוד', draw: function(c){ 
                        c.fillStyle = '#FFC0CB';
                        c.beginPath();
                        c.arc(250, 225, 12, 0, Math.PI);
                        c.fill();
                        c.strokeStyle = '#FF69B4';
                        c.lineWidth = 2;
                        c.stroke();
                    }},
                    { instruction: 'שלב 25: פנינה בצדפה - עיגול לבן', draw: function(c){ 
                        c.fillStyle = '#FFFFFF';
                        c.beginPath();
                        c.arc(250, 222, 5, 0, Math.PI * 2);
                        c.fill();
                    }}
                ]
            }
        };
        
        function init() {
            var p = document.getElementById('colorPalette');
            for (var i = 0; i < cols.length; i++) {
                var b = document.createElement('div');
                b.className = 'color-btn' + (cols[i] === col ? ' selected' : '');
                b.style.background = cols[i];
                b.setAttribute('data-color', cols[i]);
                b.onclick = function() {
                    col = this.getAttribute('data-color');
                    erase = false;
                    var all = document.querySelectorAll('.color-btn');
                    for (var j = 0; j < all.length; j++) all[j].classList.remove('selected');
                    this.classList.add('selected');
                    document.getElementById('drawBtn').classList.add('active');
                    document.getElementById('eraserBtn').classList.remove('active');
                    updCursor();
                };
                p.appendChild(b);
            }
        }
        
        function selectDrawTool() {
            erase = false;
            document.getElementById('drawBtn').classList.add('active');
            document.getElementById('eraserBtn').classList.remove('active');
            updCursor();
        }
        
        function selectEraser() {
            erase = true;
            document.getElementById('eraserBtn').classList.add('active');
            document.getElementById('drawBtn').classList.remove('active');
            var all = document.querySelectorAll('.color-btn');
            for (var i = 0; i < all.length; i++) all[i].classList.remove('selected');
            updCursor();
        }
        
        document.getElementById('brushSize').addEventListener('input', function(e) {
            size = parseInt(e.target.value);
            updCursor();
        });
        
        function showMenu() {
            document.getElementById('drawingMenu').classList.remove('hidden');
            document.getElementById('overlay').classList.remove('hidden');
        }
        
        function hideMenu() {
            document.getElementById('drawingMenu').classList.add('hidden');
            document.getElementById('overlay').classList.add('hidden');
        }
        
        function selectDrawing(n) {
            curr = data[n];
            step = 0;
            exCtx.clearRect(0, 0, 400, 400);
            myCtx.clearRect(0, 0, 400, 400);
            upd();
            hideMenu();
            document.getElementById('nextBtn').disabled = false;
        }
        
        function clearMyCanvas() {
            myCtx.clearRect(0, 0, 400, 400);
        }
        
        function saveDrawing() {
            if (!curr) { alert('בחר ציור תחילה!'); return; }
            var l = document.createElement('a');
            l.download = 'ציור_' + curr.name + '.png';
            l.href = my.toDataURL();
            l.click();
        }
        
        function upd() {
            if (!curr) return;
            exCtx.clearRect(0, 0, 400, 400);
            for (var i = 0; i <= step; i++) curr.steps[i].draw(exCtx);
            document.getElementById('instruction').textContent = curr.steps[step].instruction;
            document.getElementById('stepCounter').textContent = 'שלב ' + (step + 1) + ' מתוך ' + curr.steps.length;
            document.getElementById('prevBtn').disabled = step === 0;
            document.getElementById('nextBtn').disabled = step === curr.steps.length - 1;
        }
        
        function nextStep() {
            if (curr && step < curr.steps.length - 1) { step++; upd(); }
        }
        
        function prevStep() {
            if (step > 0) { step--; upd(); }
        }
        
        my.addEventListener('mousedown', function(e) {
            draw = true;
            var r = my.getBoundingClientRect();
            myCtx.beginPath();
            myCtx.moveTo(e.clientX - r.left, e.clientY - r.top);
        });
        
        my.addEventListener('mousemove', function(e) {
            if (!draw) return;
            var r = my.getBoundingClientRect();
            myCtx.lineCap = 'round';
            myCtx.lineJoin = 'round';
            if (erase) {
                myCtx.globalCompositeOperation = 'destination-out';
                myCtx.lineWidth = size * 2;
            } else {
                myCtx.globalCompositeOperation = 'source-over';
                myCtx.strokeStyle = col;
                myCtx.lineWidth = size;
            }
            myCtx.lineTo(e.clientX - r.left, e.clientY - r.top);
            myCtx.stroke();
        });
        
        my.addEventListener('mouseup', function() { draw = false; });
        my.addEventListener('mouseout', function() { draw = false; });
        
        my.addEventListener('touchstart', function(e) {
            e.preventDefault();
            draw = true;
            var t = e.touches[0];
            var r = my.getBoundingClientRect();
            myCtx.beginPath();
            myCtx.moveTo(t.clientX - r.left, t.clientY - r.top);
        });
        
        my.addEventListener('touchmove', function(e) {
            e.preventDefault();
            if (!draw) return;
            var t = e.touches[0];
            var r = my.getBoundingClientRect();
            myCtx.lineCap = 'round';
            myCtx.lineJoin = 'round';
            if (erase) {
                myCtx.globalCompositeOperation = 'destination-out';
                myCtx.lineWidth = size * 2;
            } else {
                myCtx.globalCompositeOperation = 'source-over';
                myCtx.strokeStyle = col;
                myCtx.lineWidth = size;
            }
            myCtx.lineTo(t.clientX - r.left, t.clientY - r.top);
            myCtx.stroke();
        });
        
        my.addEventListener('touchend', function() { draw = false; });
        
        init();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×—×™×‘×•×¨ ×•×—×™×¡×•×¨ ×¢×“ 10,000</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; background: white; border-radius: 25px; padding: 40px; box-shadow: 0 25px 70px rgba(0,0,0,0.4); }
        h1 { color: #667eea; text-align: center; margin-bottom: 15px; font-size: 3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .subtitle { text-align: center; color: #666; margin-bottom: 35px; font-size: 1.3em; }
        .tabs { display: flex; gap: 12px; margin-bottom: 35px; flex-wrap: wrap; justify-content: center; }
        .tab { padding: 16px 28px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 12px; cursor: pointer; font-size: 1.15em; font-weight: bold; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); color: white; }
        .tab:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); background: linear-gradient(135deg, #7c8ef5 0%, #8a5eb8 100%); }
        .tab.active { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); transform: scale(1.05); }
        .content { display: none; }
        .content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .lesson { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 30px; border-radius: 20px; margin-bottom: 25px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .lesson h2 { color: #ff6b6b; margin-bottom: 20px; font-size: 1.8em; }
        .lesson p { font-size: 1.2em; line-height: 1.8; margin-bottom: 15px; color: #333; }
        .example { background: white; padding: 20px; border-right: 5px solid #667eea; margin: 20px 0; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); }
        .example h3 { color: #f093fb; margin-bottom: 12px; font-size: 1.3em; }
        .calculation { font-family: 'Courier New', monospace; background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0; text-align: center; font-size: 1.5em; }
        .calc-content { direction: ltr; display: inline-block; }
        .game { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 20px; margin-bottom: 25px; color: white; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .game h2 { margin-bottom: 20px; font-size: 2em; }
        .question-counter { text-align: center; font-size: 1.3em; margin: 15px 0; color: #fff; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; }
        .score { text-align: center; font-size: 1.8em; margin: 25px 0; color: #fff; font-weight: bold; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; }
        .problem-display { font-size: 3em; text-align: center; margin: 30px 0; padding: 25px; background: rgba(255,255,255,0.3); border-radius: 15px; font-weight: bold; font-family: 'Courier New', monospace; }
        .problem-content { direction: ltr; display: inline-block; }
        .word-problem { font-size: 1.4em; text-align: center; margin: 30px 0; padding: 30px; background: rgba(255,255,255,0.3); border-radius: 15px; line-height: 1.8; direction: rtl; }
        input[type="number"] { width: 200px; padding: 15px; font-size: 1.8em; border: 4px solid #667eea; border-radius: 10px; text-align: center; margin: 10px; font-weight: bold; }
        input[type="number"]::placeholder { text-align: center; font-size: 0.7em; color: #999; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 14px 35px; font-size: 1.2em; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: bold; box-shadow: 0 6px 12px rgba(0,0,0,0.2); margin: 5px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
        .btn-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .feedback { padding: 20px; border-radius: 12px; margin-top: 20px; font-size: 1.3em; text-align: center; font-weight: bold; }
        .correct { background: #51cf66; color: white; }
        .incorrect { background: #ff6b6b; color: white; }
        .controls { text-align: center; margin: 25px 0; }
        .round-complete { background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); padding: 40px; border-radius: 20px; text-align: center; color: white; margin: 20px 0; }
        .round-complete h3 { font-size: 2.5em; margin-bottom: 20px; }
        .round-complete p { font-size: 1.5em; margin: 15px 0; }
        .new-round-btn { background: white; color: #51cf66; font-size: 1.5em; padding: 20px 40px; margin-top: 20px; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; box-shadow: 0 8px 16px rgba(0,0,0,0.2); transition: all 0.3s; }
        .new-round-btn:hover { transform: scale(1.05); box-shadow: 0 12px 24px rgba(0,0,0,0.3); }
        .steps { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin: 20px 0; text-align: right; }
        .steps p { margin: 10px 0; font-size: 1.1em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>×—×™×‘×•×¨ ×•×—×™×¡×•×¨ ×¢×“ 10,000</h1>
        <div class="subtitle">×›×™×ª×” ×“' - ×‘×•××• × ×œ××“ ×—×©×‘×•×Ÿ!</div>
        
        <div class="tabs">
            <button class="tab active" data-tab="lesson1">ğŸ“š ××œ×’×•×¨×™×ª××™× ×œ×—×™×‘×•×¨ ×•×—×™×¡×•×¨</button>
            <button class="tab" data-tab="game1">ğŸ® ××©×—×§ ×—×™×‘×•×¨ ×•×—×™×¡×•×¨</button>
            <button class="tab" data-tab="lesson2">ğŸ“š ××•××“×Ÿ</button>
            <button class="tab" data-tab="game2">ğŸ¯ ××©×—×§ ××•××“×Ÿ</button>
            <button class="tab" data-tab="lesson3">ğŸ“š ×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª</button>
            <button class="tab" data-tab="game3">ğŸ† ××©×—×§ ×‘×¢×™×•×ª</button>
        </div>
        
        <div id="lesson1" class="content active">
            <div class="lesson">
                <h2>××œ×’×•×¨×™×ª××™× ×œ×—×™×‘×•×¨ ×•×—×™×¡×•×¨</h2>
                <p>××œ×’×•×¨×™×ª× ×”×•× ×“×¨×š ××¡×•×“×¨×ª ×œ×¤×ª×•×¨ ×ª×¨×’×™×œ. ×‘×•××• × ×œ××“ ××™×š ×œ×—×‘×¨ ×•×œ×—×¡×¨ ××¡×¤×¨×™× ×’×“×•×œ×™×!</p>
                
                <div class="example">
                    <h3>×“×•×’××” 1: ×—×™×‘×•×¨ ×¢× ×¢×‘×¨</h3>
                    <p><strong>×©××œ×”:</strong> <span dir="ltr">4,567 + 3,856 = ?</span></p>
                    <div class="calculation">
                      <div class="calc-content">
                      4567
                    + 3856
                    ------
                      8423
                      </div>
                    </div>
                    <div class="steps">
                        <p><strong>×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:</strong></p>
                        <p>1. ××—×“×•×ª: <span dir="ltr">7 + 6 = 13</span> (×›×•×ª×‘×™× 3, ×¢×•×‘×¨ 1)</p>
                        <p>2. ×¢×©×¨×•×ª: <span dir="ltr">6 + 5 + 1 = 12</span> (×›×•×ª×‘×™× 2, ×¢×•×‘×¨ 1)</p>
                        <p>3. ×××•×ª: <span dir="ltr">5 + 8 + 1 = 14</span> (×›×•×ª×‘×™× 4, ×¢×•×‘×¨ 1)</p>
                        <p>4. ××œ×¤×™×: <span dir="ltr">4 + 3 + 1 = 8</span></p>
                        <p><strong>×ª×©×•×‘×”:</strong> <span dir="ltr">8,423</span></p>
                    </div>
                </div>
                
                <div class="example">
                    <h3>×“×•×’××” 2: ×—×™×¡×•×¨ ×¢× ×”×©××œ×”</h3>
                    <p><strong>×©××œ×”:</strong> <span dir="ltr">7,234 - 2,876 = ?</span></p>
                    <div class="calculation">
                      <div class="calc-content">
                      7234
                    - 2876
                    ------
                      4358
                      </div>
                    </div>
                    <div class="steps">
                        <p><strong>×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:</strong></p>
                        <p>1. ××—×“×•×ª: ×œ× ×™×›×•×œ <span dir="ltr">4 - 6</span>, ×©×•××œ×™× 10. ×¢×›×©×™×• <span dir="ltr">14 - 6 = 8</span></p>
                        <p>2. ×¢×©×¨×•×ª: ××—×¨×™ ×”×©××œ×” <span dir="ltr">2 - 7</span>? ×œ× ×™×›×•×œ, ×©×•××œ×™×. <span dir="ltr">12 - 7 = 5</span></p>
                        <p>3. ×××•×ª: ××—×¨×™ ×”×©××œ×” <span dir="ltr">1 - 8</span>? ×œ× ×™×›×•×œ, ×©×•××œ×™×. <span dir="ltr">11 - 8 = 3</span></p>
                        <p>4. ××œ×¤×™×: ××—×¨×™ ×”×©××œ×” <span dir="ltr">6 - 2 = 4</span></p>
                        <p><strong>×ª×©×•×‘×”:</strong> <span dir="ltr">4,358</span></p>
                    </div>
                </div>
                
                <div class="example">
                    <h3>×˜×™×¤ ×—×©×•×‘!</h3>
                    <p>×ª××™×“ ×›×“××™ ×œ×‘×“×•×§ ××ª ×”×ª×©×•×‘×”:</p>
                    <p>â€¢ ×‘×—×™×‘×•×¨: × ×—×¡×¨ ××—×“ ×”××¡×¤×¨×™× ××”×ª×©×•×‘×” ×•× ×§×‘×œ ××ª ×”×©× ×™</p>
                    <p>â€¢ ×‘×—×™×¡×•×¨: × ×—×‘×¨ ××ª ×”×ª×©×•×‘×” ×¢× ×”××¡×¤×¨ ×©×—×™×¡×¨× ×• ×•× ×§×‘×œ ××ª ×”××¡×¤×¨ ×”×¨××©×•×Ÿ</p>
                </div>
            </div>
        </div>
        
        <div id="game1" class="content">
            <div class="game">
                <h2>××©×—×§ ×—×™×‘×•×¨ ×•×—×™×¡×•×¨</h2>
                <div class="question-counter">×©××œ×” <span id="q-count1">1</span> ××ª×•×š 12</div>
                <div class="score">× ×™×§×•×“: <span id="score1">0</span></div>
                <div class="problem-display" id="problem1">×˜×•×¢×Ÿ...</div>
                <div class="controls">
                    <input type="number" id="answer1" placeholder="×”×›× ×¡ ×ª×©×•×‘×”">
                    <br><br>
                    <button id="check1">×‘×“×•×§</button>
                </div>
                <div id="feedback1"></div>
                <div id="round-end1" style="display: none;"></div>
            </div>
        </div>
        
        <div id="lesson2" class="content">
            <div class="lesson">
                <h2>××•××“×Ÿ ×•×‘×“×™×§×ª ×¡×‘×™×¨×•×ª</h2>
                <p>××•××“×Ÿ ×–×” ×”×¢×¨×›×” ××”×™×¨×” ×©×œ ×”×ª×•×¦××”. ×–×” ×¢×•×–×¨ ×œ× ×• ×œ×‘×“×•×§ ×× ×”×ª×©×•×‘×” ×©×œ× ×• ×”×’×™×•× ×™×ª!</p>
                
                <div class="example">
                    <h3>××™×š ××¢×¨×™×›×™× (××•××“×™×)?</h3>
                    <p>× ×¢×’×œ ×›×œ ××¡×¤×¨ ×œ××œ×¤×™× ×”×§×¨×•×‘×™× ×‘×™×•×ª×¨:</p>
                    <p>â€¢ <span dir="ltr">3,456 â†’ 3,000</span></p>
                    <p>â€¢ <span dir="ltr">4,780 â†’ 5,000</span></p>
                    <p>â€¢ <span dir="ltr">6,234 â†’ 6,000</span></p>
                </div>
                
                <div class="example">
                    <h3>×“×•×’××” 1: ××•××“×Ÿ ×—×™×‘×•×¨</h3>
                    <p><strong>×©××œ×”:</strong> <span dir="ltr">4,782 + 3,156 = ?</span></p>
                    <p><strong>××•××“×Ÿ:</strong></p>
                    <p><span dir="ltr">4,782 â†’ 5,000</span></p>
                    <p><span dir="ltr">3,156 â†’ 3,000</span></p>
                    <p><span dir="ltr">5,000 + 3,000 = 8,000</span></p>
                    <p><strong>×—×™×©×•×‘ ××“×•×™×§:</strong> <span dir="ltr">7,938</span></p>
                    <p>×”×ª×©×•×‘×” ×§×¨×•×‘×” ×œ-8,000 - ×”×’×™×•× ×™!</p>
                </div>
                
                <div class="example">
                    <h3>×“×•×’××” 2: ×‘×“×™×§×ª ×¡×‘×™×¨×•×ª</h3>
                    <p>×™×•×¡×™ ×—×™×©×‘: <span dir="ltr">8,456 - 3,234 = 11,690</span></p>
                    <p><strong>×‘×“×™×§×”:</strong> ×›×©××—×¡×¨×™×, ×”×ª×•×¦××” ×¦×¨×™×›×” ×œ×”×™×•×ª ×§×˜× ×” ×™×•×ª×¨!</p>
                    <p><span dir="ltr">8,456</span> ×”×•× ×›-8,000</p>
                    <p><span dir="ltr">3,234</span> ×”×•× ×›-3,000</p>
                    <p><span dir="ltr">8,000 - 3,000 = 5,000</span></p>
                    <p>11,690 ×œ× ×”×’×™×•× ×™! ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×”×™× <span dir="ltr">5,222</span></p>
                </div>
            </div>
        </div>
        
        <div id="game2" class="content">
            <div class="game">
                <h2>××©×—×§ ××•××“×Ÿ</h2>
                <div class="question-counter">×©××œ×” <span id="q-count2">1</span> ××ª×•×š 12</div>
                <div class="score">× ×™×§×•×“: <span id="score2">0</span></div>
                <div class="problem-display" id="problem2">×˜×•×¢×Ÿ...</div>
                <div class="controls">
                    <input type="number" id="answer2" placeholder="×”×›× ×¡ ××•××“×Ÿ">
                    <br><br>
                    <button id="check2">×‘×“×•×§</button>
                </div>
                <div id="feedback2"></div>
                <div id="round-end2" style="display: none;"></div>
            </div>
        </div>
        
        <div id="lesson3" class="content">
            <div class="lesson">
                <h2>×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª ××•×¨×›×‘×•×ª</h2>
                <p>×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª ××•×¨×›×‘×•×ª ×“×•×¨×©×•×ª ×™×•×ª×¨ ××©×œ×‘ ××—×“ ×œ×¤×ª×¨×•×Ÿ. × ×œ××“ ××™×š ×œ×¤×¨×§ ××•×ª×Ÿ ×œ×©×œ×‘×™× ×§×˜× ×™×!</p>
                
                <div class="example">
                    <h3>×“×•×’××” 1: ×‘×¢×™×” ×‘×©× ×™ ×©×œ×‘×™×</h3>
                    <p><strong>×‘×¢×™×”:</strong> ×‘×—× ×•×ª ×”×™×• 2,345 ×¡×¤×¨×™×. ×‘××”×œ×š ×”×©×‘×•×¢ ×”×’×™×¢×• ×¢×•×“ 1,234 ×¡×¤×¨×™×, ×•× ××›×¨×• 876 ×¡×¤×¨×™×. ×›××” ×¡×¤×¨×™× ×™×© ×¢×›×©×™×• ×‘×—× ×•×ª?</p>
                    <div class="steps">
                        <p><strong>×¤×ª×¨×•×Ÿ:</strong></p>
                        <p>×©×œ×‘ 1: ××—×‘×¨×™× ××ª ×”×¡×¤×¨×™× ×©×”×’×™×¢×•</p>
                        <p><span dir="ltr">2,345 + 1,234 = 3,579</span> ×¡×¤×¨×™×</p>
                        <p>×©×œ×‘ 2: ××—×¡×¨×™× ××ª ×”×¡×¤×¨×™× ×©× ××›×¨×•</p>
                        <p><span dir="ltr">3,579 - 876 = 2,703</span> ×¡×¤×¨×™×</p>
                        <p><strong>×ª×©×•×‘×”:</strong> <span dir="ltr">2,703</span> ×¡×¤×¨×™×</p>
                    </div>
                </div>
                
                <div class="example">
                    <h3>×“×•×’××” 2: ×‘×¢×™×” ×‘×©×œ×•×©×” ×©×œ×‘×™×</h3>
                    <p><strong>×‘×¢×™×”:</strong> ×‘×‘×™×ª ×¡×¤×¨ ×™×© 3 ×›×™×ª×•×ª ×“'. ×‘×“'1 ×™×© 28 ×ª×œ××™×“×™×, ×‘×“'2 ×™×© 32 ×ª×œ××™×“×™×, ×•×‘×“'3 ×™×© 30 ×ª×œ××™×“×™×. ×‘×©×›×‘×” ×’' ×™×© 85 ×ª×œ××™×“×™×. ×›××” ×ª×œ××™×“×™× ×™×•×ª×¨ ×™×© ×‘×©×›×‘×” ×“' ×××©×¨ ×‘×©×›×‘×” ×’'?</p>
                    <div class="steps">
                        <p><strong>×¤×ª×¨×•×Ÿ:</strong></p>
                        <p>×©×œ×‘ 1: ××—×‘×¨×™× ××ª ×›×œ ×ª×œ××™×“×™ ×“'1</p>
                        <p><span dir="ltr">28</span> ×ª×œ××™×“×™×</p>
                        <p>×©×œ×‘ 2: ××•×¡×™×¤×™× ××ª ×“'2</p>
                        <p><span dir="ltr">28 + 32 = 60</span> ×ª×œ××™×“×™×</p>
                        <p>×©×œ×‘ 3: ××•×¡×™×¤×™× ××ª ×“'3</p>
                        <p><span dir="ltr">60 + 30 = 90</span> ×ª×œ××™×“×™×</p>
                        <p>×©×œ×‘ 4: ××—×¡×¨×™× ×›×“×™ ×œ××¦×•× ××ª ×”×”×¤×¨×©</p>
                        <p><span dir="ltr">90 - 85 = 5</span> ×ª×œ××™×“×™×</p>
                        <p><strong>×ª×©×•×‘×”:</strong> ×™×© <span dir="ltr">5</span> ×ª×œ××™×“×™× ×™×•×ª×¨ ×‘×©×›×‘×” ×“'</p>
                    </div>
                </div>
                
                <div class="example">
                    <h3>×˜×™×¤ ×—×©×•×‘!</h3>
                    <p>×›×©×¤×•×ª×¨×™× ×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª:</p>
                    <p>1. ×§×¨××• ××ª ×”×‘×¢×™×” ×‘×¢×™×•×Ÿ</p>
                    <p>2. ×¡×× ×• ××ª ×”××¡×¤×¨×™× ×”×—×©×•×‘×™×</p>
                    <p>3. ×—×©×‘×• ××” ×”×©××œ×” ××‘×§×©×ª</p>
                    <p>4. ×¤×ª×¨×• ×©×œ×‘ ××—×¨×™ ×©×œ×‘</p>
                    <p>5. ×‘×“×§×• ×©×”×ª×©×•×‘×” ×”×’×™×•× ×™×ª</p>
                </div>
            </div>
        </div>
        
        <div id="game3" class="content">
            <div class="game">
                <h2>××©×—×§ ×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª</h2>
                <div class="question-counter">×©××œ×” <span id="q-count3">1</span> ××ª×•×š 12</div>
                <div class="score">× ×™×§×•×“: <span id="score3">0</span></div>
                <div class="word-problem" id="problem3">×˜×•×¢×Ÿ...</div>
                <div class="controls">
                    <input type="number" id="answer3" placeholder="×”×›× ×¡ ×ª×©×•×‘×”">
                    <br><br>
                    <button id="check3">×‘×“×•×§</button>
                </div>
                <div id="feedback3"></div>
                <div id="round-end3" style="display: none;"></div>
            </div>
        </div>
    </div>

<script>
var scores = {1: 0, 2: 0, 3: 0};
var currentQuestion = {1: 0, 2: 0, 3: 0};
var questionBank = {1: [], 2: [], 3: []};
var gameData = {1: {}, 2: {}, 3: {}};
var gamesInitialized = {1: false, 2: false, 3: false};

function generateQ1() {
    var isAdd = Math.random() < 0.5;
    var n1 = Math.floor(Math.random() * 9000) + 1000;
    var n2 = Math.floor(Math.random() * 9000) + 1000;
    var n1Formatted = n1.toLocaleString('en-US');
    var n2Formatted = n2.toLocaleString('en-US');
    if (isAdd) return {text: n1Formatted + ' + ' + n2Formatted, answer: n1 + n2};
    var big = Math.max(n1, n2);
    var small = Math.min(n1, n2);
    var bigFormatted = big.toLocaleString('en-US');
    var smallFormatted = small.toLocaleString('en-US');
    return {text: bigFormatted + ' - ' + smallFormatted, answer: big - small};
}

function generateQ2() {
    var isAdd = Math.random() < 0.5;
    var n1 = Math.floor(Math.random() * 9000) + 1000;
    var n2 = Math.floor(Math.random() * 9000) + 1000;
    var n1Formatted = n1.toLocaleString('en-US');
    var n2Formatted = n2.toLocaleString('en-US');
    var r1 = Math.round(n1 / 1000) * 1000;
    var r2 = Math.round(n2 / 1000) * 1000;
    if (isAdd) return {text: n1Formatted + ' + ' + n2Formatted, answer: r1 + r2};
    var big = Math.max(n1, n2);
    var small = Math.min(n1, n2);
    var bigFormatted = big.toLocaleString('en-US');
    var smallFormatted = small.toLocaleString('en-US');
    var rb = Math.round(big / 1000) * 1000;
    var rs = Math.round(small / 1000) * 1000;
    return {text: bigFormatted + ' - ' + smallFormatted, answer: rb - rs};
}

function generateQ3() {
    var n1 = Math.floor(Math.random() * 5000) + 2000;
    var n2 = Math.floor(Math.random() * 3000) + 1000;
    var n3 = Math.floor(Math.random() * 2000) + 500;
    var n1F = n1.toLocaleString('en-US');
    var n2F = n2.toLocaleString('en-US');
    var n3F = n3.toLocaleString('en-US');
    var t = Math.floor(Math.random() * 3);
    if (t === 0) return {text: '×‘×¡×¤×¨×™×™×” ×”×™×• ' + n1F + ' ×¡×¤×¨×™×. ×”×’×™×¢×• ' + n2F + ' ×¡×¤×¨×™× ×•×œ×§×—×• ' + n3F + '. ×›××” × ×©××¨×•?', answer: n1 + n2 - n3};
    if (t === 1) return {text: '×‘×—× ×•×ª ×”×™×• ' + n1F + ' ××©×—×§×™×. ××›×¨×• ' + n2F + ' ×•×”×–××™× ×• ' + n3F + '. ×›××” ×™×© ×¢×›×©×™×•?', answer: n1 - n2 + n3};
    return {text: '×™×•×¡×™ ×—×¡×š ' + n1F + ' ×©×§×œ×™×. ×§×™×‘×œ ' + n2F + ' ×•×§× ×” ×‘-' + n3F + '. ×›××” × ×©××¨?', answer: n1 + n2 - n3};
}

function initGame(g) {
    if (questionBank[g].length === 0) {
        for (var i = 0; i < 20; i++) {
            if (g === 1) questionBank[g].push(generateQ1());
            else if (g === 2) questionBank[g].push(generateQ2());
            else questionBank[g].push(generateQ3());
        }
    }
    if (currentQuestion[g] === 0) {
        nextQ(g);
    }
}

function nextQ(g) {
    if (currentQuestion[g] >= 12) { showEnd(g); return; }
    gameData[g] = questionBank[g][currentQuestion[g]];
    document.getElementById('q-count' + g).textContent = currentQuestion[g] + 1;
    if (g === 3) {
        document.getElementById('problem3').textContent = gameData[g].text;
    } else {
        document.getElementById('problem' + g).innerHTML = '<div class="problem-content">' + gameData[g].text + ' = ?</div>';
    }
    document.getElementById('answer' + g).value = '';
    document.getElementById('feedback' + g).innerHTML = '';
}

function checkAns(g) {
    var ans = parseInt(document.getElementById('answer' + g).value);
    if (isNaN(ans)) return;
    currentQuestion[g]++;
    if (ans === gameData[g].answer) {
        scores[g]++;
        playSound('correct');
        document.getElementById('feedback' + g).innerHTML = '<div class="feedback correct">× ×›×•×Ÿ!</div>';
    } else {
        playSound('incorrect');
        var correctAns = gameData[g].answer.toLocaleString('en-US');
        document.getElementById('feedback' + g).innerHTML = '<div class="feedback incorrect">×œ× × ×›×•×Ÿ. ×ª×©×•×‘×”: ' + correctAns + '</div>';
    }
    document.getElementById('score' + g).textContent = scores[g];
    
    // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ×¤×™×“×‘×§
    setTimeout(function() {
        document.getElementById('feedback' + g).scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 100);
    
    setTimeout(function() { nextQ(g); }, 1500);
}

function showEnd(g) {
    var pct = Math.round((scores[g] / 12) * 100);
    var html = '<div class="round-complete"><h3>×¡×™×™××ª!</h3><p>×¦×™×•×Ÿ: ' + scores[g] + '/12 (' + pct + '%)</p><button class="new-round-btn" onclick="resetGame(' + g + ')">×¡×™×‘×•×‘ × ×•×¡×£</button></div>';
    document.getElementById('round-end' + g).innerHTML = html;
    document.getElementById('round-end' + g).style.display = 'block';
    var probId = (g === 3) ? 'problem3' : 'problem' + g;
    document.getElementById(probId).style.display = 'none';
}

function resetGame(g) {
    scores[g] = 0;
    currentQuestion[g] = 0;
    document.getElementById('score' + g).textContent = '0';
    document.getElementById('round-end' + g).style.display = 'none';
    document.getElementById('feedback' + g).innerHTML = '';
    document.getElementById('answer' + g).value = '';
    var probId = (g === 3) ? 'problem3' : 'problem' + g;
    document.getElementById(probId).style.display = 'block';
    
    questionBank[g] = [];
    for (var i = 0; i < 20; i++) {
        if (g === 1) questionBank[g].push(generateQ1());
        else if (g === 2) questionBank[g].push(generateQ2());
        else questionBank[g].push(generateQ3());
    }
    
    var controlsSelector = (g === 1) ? '#game1 .controls' : (g === 2) ? '#game2 .controls' : '#game3 .controls';
    var controls = document.querySelector(controlsSelector);
    if (controls) controls.style.display = 'block';
    
    nextQ(g);
}

window.onload = function() {
    var tabs = document.querySelectorAll('.tab');
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].onclick = function() {
            playSound('click');
            var tabId = this.getAttribute('data-tab');
            var allContent = document.querySelectorAll('.content');
            var allTabs = document.querySelectorAll('.tab');
            
            for (var j = 0; j < allContent.length; j++) {
                allContent[j].classList.remove('active');
            }
            for (var k = 0; k < allTabs.length; k++) {
                allTabs[k].classList.remove('active');
            }
            
            document.getElementById(tabId).classList.add('active');
            this.classList.add('active');
            
            if (tabId === 'game1' && !gamesInitialized[1]) {
                initGame(1);
                gamesInitialized[1] = true;
            } else if (tabId === 'game2' && !gamesInitialized[2]) {
                initGame(2);
                gamesInitialized[2] = true;
            } else if (tabId === 'game3' && !gamesInitialized[3]) {
                initGame(3);
                gamesInitialized[3] = true;
            }
        };
    }
    
    document.getElementById('check1').onclick = function() { playSound('click'); checkAns(1); };
    document.getElementById('check2').onclick = function() { playSound('click'); checkAns(2); };
    document.getElementById('check3').onclick = function() { playSound('click'); checkAns(3); };
    
    var answerInputs = document.querySelectorAll('input[type="number"]');
    for (var i = 0; i < answerInputs.length; i++) {
        answerInputs[i].addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                var gameNum = this.id.charAt(this.id.length - 1);
                playSound('click');
                checkAns(parseInt(gameNum));
            }
        });
    }
};

function playSound(type) {
    var audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
    if (type === 'click') {
        var osc = audioContext.createOscillator();
        var gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.type = 'sine';
        osc.frequency.value = 600;
        gain.gain.setValueAtTime(0.15, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
        osc.start(audioContext.currentTime);
        osc.stop(audioContext.currentTime + 0.15);
    } else if (type === 'correct') {
        var notes = [523.25, 659.25, 783.99];
        for (var i = 0; i < notes.length; i++) {
            var osc = audioContext.createOscillator();
            var gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.type = 'sine';
            osc.frequency.value = notes[i];
            gain.gain.setValueAtTime(0.1, audioContext.currentTime + i * 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
            osc.start(audioContext.currentTime + i * 0.1);
            osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
        }
    } else if (type === 'incorrect') {
        var osc = audioContext.createOscillator();
        var gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.type = 'sine';
        osc.frequency.value = 200;
        gain.gain.setValueAtTime(0.15, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        osc.start(audioContext.currentTime);
        osc.stop(audioContext.currentTime + 0.3);
    }
}
</script>
</body>
</html>

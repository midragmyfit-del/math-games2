<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×•×¥ ×”×›×¤×œ ×”×’×“×•×œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
        }

        /* ===== ×ª×¤×¨×™×˜ ×¨××©×™ ===== */
        .menu-screen {
            text-align: center;
        }

        .menu-screen h1 {
            font-size: 3.5em;
            color: #667eea;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .menu-screen .subtitle {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 50px;
        }

        .mode-selector {
            margin-bottom: 50px;
        }

        .mode-selector h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 25px;
        }

        .mode-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 20px 40px;
            font-size: 1.3em;
            border: 3px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        /* ===== ×‘×—×™×¨×ª ×¨××ª ×§×•×©×™ ===== */
        .difficulty-selector {
            margin-bottom: 40px;
        }

        .difficulty-selector h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 25px;
        }

        .difficulty-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 20px 60px;
            font-size: 1.2em;
            border: 3px solid #999;
            background: white;
            color: #999;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .difficulty-btn.easy {
            border-color: #4caf50;
            color: #4caf50;
        }

        .difficulty-btn.medium {
            border-color: #ff9800;
            color: #ff9800;
        }

        .difficulty-btn.hard {
            border-color: #f44336;
            color: #f44336;
        }

        .difficulty-btn:hover {
            transform: scale(1.05);
        }

        .difficulty-btn.active {
            color: white;
        }

        .difficulty-btn.easy.active {
            background: #4caf50;
            border-color: #4caf50;
        }

        .difficulty-btn.medium.active {
            background: #ff9800;
            border-color: #ff9800;
        }

        .difficulty-btn.hard.active {
            background: #f44336;
            border-color: #f44336;
        }

        /* ===== ××¢×‘×“×ª ×”×›×¤×œ ===== */
        .lab-screen {
            display: none;
        }

        .lab-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .lab-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .lab-header h2 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .lab-header p {
            font-size: 1.2em;
            color: #666;
        }

        .lab-problem {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 40px;
            font-size: 3.5em;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lab-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .hint-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .hint-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .answer-area {
            background: #f5f5f5;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            min-height: 200px;
        }

        .visualization {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
        }

        .group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            animation: pop-in 0.3s ease-out;
            margin: 5px;
        }

        @keyframes pop-in {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            70% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .counter-display {
            text-align: center;
            margin-top: 30px;
        }

        .counter-display p {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .current-count {
            font-size: 2.5em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .count-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .count-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.5em;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .count-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .count-btn.submit {
            background: #4caf50;
            padding: 12px 50px;
            font-size: 1.2em;
            color: white;
        }

        .count-btn.submit:hover {
            background: #45a049;
        }

        .count-btn.increment,
        .count-btn.decrement {
            font-size: 1.8em !important;
            color: white !important;
            padding: 15px 35px !important;
            min-width: 70px;
        }

        .feedback {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 20px;
            min-height: 30px;
            font-weight: bold;
            direction: ltr;
        }

        .feedback.correct {
            color: #4caf50;
        }

        .feedback.incorrect {
            color: #f44336;
        }

        .nav-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 40px;
        }

        .next-btn, .back-lab-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .next-btn {
            background: #667eea;
            color: white;
        }

        .next-btn:hover {
            background: #764ba2;
            transform: translateY(-3px);
        }

        .next-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .back-lab-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .back-lab-btn:hover {
            background: #667eea;
            color: white;
        }

        .start-game-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.5em;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .start-game-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .start-game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== ×”××©×—×§ ===== */
        .game-screen {
            display: none;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .back-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
        }

        .game-title {
            font-size: 2.2em;
            color: #667eea;
            font-weight: bold;
        }

        .timer {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 15px;
            font-size: 1.1em;
        }

        .progress-info span {
            color: #667eea;
            font-weight: bold;
        }

        /* ===== ×˜×‘×œ×ª ×”×›×¤×œ ===== */
        .multiplication-table {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 8px;
            margin-bottom: 30px;
            max-height: 250px;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 15px;
        }

        .table-cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: bold;
            border: 2px solid #ddd;
            cursor: default;
            background: white;
            direction: ltr;
        }

        .table-cell.current {
            background: #ffeb3b;
            border-color: #ff9800;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }

        .table-cell.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .table-cell.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        /* ===== ×©××œ×” ===== */
        .question-container {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .question {
            font-size: 3em;
            color: #333;
            font-weight: bold;
            margin-bottom: 20px;
            font-family: 'Arial', sans-serif;
            direction: ltr;
        }

        /* ===== ×ª×©×•×‘×•×ª ===== */
        .answers-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .answer-btn {
            padding: 25px;
            font-size: 1.8em;
            border: 3px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .answer-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .answer-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .answer-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: shake 0.5s;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* ===== ×¡×™×•× ××©×—×§ ===== */
        .finish-screen {
            display: none;
            text-align: center;
        }

        .trophy-animation {
            font-size: 8em;
            margin-bottom: 20px;
            animation: bounce 0.6s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-30px);
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #667eea;
            pointer-events: none;
            animation: confetti-fall 3s ease-in forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .finish-screen h1 {
            font-size: 3.5em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .final-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            font-size: 1.5em;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .stat-row {
            margin: 20px 0;
            font-size: 1.3em;
        }

        .stat-label {
            font-weight: bold;
            margin-right: 10px;
        }

        .stat-value {
            font-size: 1.5em;
            color: #ffeb3b;
        }

        .finish-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 3px solid #667eea;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        /* ===== ×©×—×§× ×™× ===== */
        .players-container {
            display: none;
            gap: 20px;
            margin-bottom: 30px;
        }

        .player-card {
            flex: 1;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
        }

        .player1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .player2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .player-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .player-time {
            font-size: 2em;
            font-weight: bold;
        }

        .waiting-text {
            font-size: 1.2em;
            margin-top: 10px;
            opacity: 0.9;
        }

        /* ===== ×ª×•×¦××•×ª ===== */
        .results-screen {
            display: none;
            text-align: center;
        }

        .winner-announcement {
            font-size: 2.5em;
            color: #667eea;
            margin: 30px 0;
            font-weight: bold;
        }

        .comparison-table {
            width: 100%;
            margin-bottom: 30px;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
            border-bottom: 2px solid #ddd;
        }

        .comparison-table th {
            background: #f5f5f5;
            font-weight: bold;
            color: #667eea;
        }

        .comparison-table tr:nth-child(even) {
            background: #fafafa;
        }

        .penalty-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .pause-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pause-content {
            background: white;
            border-radius: 25px;
            padding: 60px 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .pause-content h1 {
            font-size: 3.5em;
            color: #667eea;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .pause-content p {
            font-size: 2em;
            color: #333;
            margin: 20px 0;
        }

        .pause-content .player-name {
            font-size: 3em;
            color: #f5576c;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .countdown {
            font-size: 4em;
            color: #667eea;
            font-weight: bold;
            margin: 30px 0;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .pause-screen.hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ===== ×ª×¤×¨×™×˜ ×¨××©×™ ===== -->
        <div id="menuScreen" class="menu-screen">
            <h1>ğŸƒâ€â™‚ï¸ ××¨×•×¥ ×”×›×¤×œ ×”×’×“×•×œ</h1>
            <p class="subtitle">×¢×‘×•×¨ ×¢×œ ×›×œ ×œ×•×— ×”×›×¤×œ ×‘×–××Ÿ ×”×§×¦×¨ ×‘×™×•×ª×¨</p>

            <div class="mode-selector">
                <h2>×‘×—×¨ ××¦×‘ ××©×—×§</h2>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="lab">ğŸ¯ ××™××•×Ÿ ×œ××™×“×ª ×›×¤×œ</button>
                    <button class="mode-btn" data-mode="single">ğŸ® ×©×—×§×Ÿ ×™×—×™×“</button>
                    <button class="mode-btn" data-mode="two">ğŸ‘¥ ×©× ×™ ×©×—×§× ×™×</button>
                </div>
            </div>

            <div class="difficulty-selector" style="display: none;">
                <h2>×‘×—×¨ ×¨××ª ×§×•×©×™</h2>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn easy active" data-difficulty="easy">ğŸŸ¢ ×§×œ (0-5)</button>
                    <button class="difficulty-btn medium" data-difficulty="medium">ğŸŸ¡ ×‘×™× ×•× ×™ (6-10)</button>
                    <button class="difficulty-btn hard" data-difficulty="hard">ğŸ”´ ×§×©×” (10-12)</button>
                </div>
            </div>

            <button class="start-game-btn" id="startBtn">×”×ª×—×œ ××©×—×§</button>
        </div>

        <!-- ===== ×”××©×—×§ ===== -->
        <div id="gameScreen" class="game-screen">
            <div class="game-header">
                <button class="back-btn" id="backFromGameBtn">â† ×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
                <div class="game-title" id="gameTitle">××¨×•×¥ ×”×›×¤×œ</div>
                <div class="timer" id="timer">00:00</div>
            </div>

            <div class="progress-info">
                <div>×©××œ×” <span id="questionNum">1</span> ××ª×•×š <span id="totalQuestions">25</span></div>
                <div>× ×›×•× ×•×ª: <span id="correctCount">0</span></div>
                <div id="penaltyDisplay" style="color: #f44336;"></div>
            </div>

            <div class="multiplication-table" id="multiplicationTable"></div>

            <div class="question-container">
                <div class="question" id="question" dir="ltr">5 Ã— 7 = ?</div>
            </div>

            <div class="answers-container" id="answersContainer"></div>

            <!-- ×›×¨×˜×™×¡×™ ×©×—×§× ×™× (×œ××¦×‘ ×©× ×™ ×©×—×§× ×™×) -->
            <div class="players-container" id="playersContainer">
                <div class="player-card player1">
                    <h3>×©×—×§×Ÿ 1</h3>
                    <div class="player-time" id="player1Time">00:00</div>
                    <div class="waiting-text" id="player1Status">×‘×ª×•×š</div>
                </div>
                <div class="player-card player2">
                    <h3>×©×—×§×Ÿ 2</h3>
                    <div class="player-time" id="player2Time">00:00</div>
                    <div class="waiting-text" id="player2Status">××—×›×”</div>
                </div>
            </div>
        </div>

        <!-- ===== ×ª×•×¦××•×ª ×©×—×§×Ÿ ×™×—×™×“ ===== -->
        <div id="finishScreen" class="finish-screen">
            <div class="trophy-animation">ğŸ†</div>
            <h1 id="finishTitle">×›×œ ×”×›×‘×•×“!</h1>
            <div class="final-stats">
                <div class="stat-row">
                    <span class="stat-label">â±ï¸ ×–××Ÿ ×¡×™×•×:</span>
                    <span class="stat-value" id="finalTime">00:00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">âœ… ×ª×©×•×‘×•×ª × ×›×•× ×•×ª:</span>
                    <span class="stat-value" id="finalCorrect">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">âŒ ×©×’×™××•×ª:</span>
                    <span class="stat-value" id="finalWrong">0</span>
                </div>
                <div class="stat-row" id="penaltyRow">
                    <span class="stat-label">âš ï¸ ×–××Ÿ ×¢×•× ×©:</span>
                    <span class="stat-value" id="finalPenalty">0</span> ×©× ×™×•×ª
                </div>
            </div>
            <div id="penaltyNotice" class="penalty-notice hidden"></div>
            <div class="finish-buttons">
                <button class="btn-primary" id="playAgainBtn">ğŸ® ××©×—×§ ×—×“×©</button>
                <button class="btn-secondary" id="backToMenuBtn">ğŸ“‹ ×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
            </div>
        </div>

        <!-- ===== ×ª×•×¦××•×ª ×©× ×™ ×©×—×§× ×™× ===== -->
        <div id="resultsScreen" class="results-screen">
            <div class="trophy-animation">ğŸ†</div>
            <h1 id="resultTitle">×ª×•×¦××•×ª</h1>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>×©×—×§×Ÿ</th>
                        <th>â±ï¸ ×–××Ÿ</th>
                        <th>âœ… × ×›×•× ×•×ª</th>
                        <th>âŒ ×©×’×™××•×ª</th>
                        <th>âš ï¸ ×¢×•× ×©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="font-weight: bold; color: #667eea;">×©×—×§×Ÿ 1</td>
                        <td id="p1ResultTime">00:00</td>
                        <td id="p1ResultCorrect">0</td>
                        <td id="p1ResultWrong">0</td>
                        <td id="p1ResultPenalty">0s</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; color: #f5576c;">×©×—×§×Ÿ 2</td>
                        <td id="p2ResultTime">00:00</td>
                        <td id="p2ResultCorrect">0</td>
                        <td id="p2ResultWrong">0</td>
                        <td id="p2ResultPenalty">0s</td>
                    </tr>
                </tbody>
            </table>
            <div id="resultPenaltyNotice" class="penalty-notice hidden"></div>
            <div class="finish-buttons">
                <button class="btn-primary" id="playAgain2Btn">ğŸ® ××©×—×§ ×—×“×©</button>
                <button class="btn-secondary" id="backToMenu2Btn">ğŸ“‹ ×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
            </div>
        </div>

        <!-- ===== ××¡×š ×”×¤×¡×§×” ×‘×™×Ÿ ×©×—×§× ×™× ===== -->
        <div id="pauseScreen" class="pause-screen hidden">
            <div class="pause-content">
                <h1>×”×¤×¡×§×”</h1>
                <p>×¡×™×™× ×©×—×§×Ÿ 1 ××ª ×ª×•×¨×•!</p>
                <div class="player-name" id="nextPlayerName">×©×—×§×Ÿ 2</div>
                <p>××•×›×Ÿ?</p>
                <div class="countdown" id="countdown">3</div>
            </div>
        </div>

        <!-- ===== ××¡×š ××¢×‘×“×ª ×”×›×¤×œ ===== -->
        <div id="labScreen" class="lab-screen">
            <div class="lab-container">
                <div class="lab-header">
                    <h2>ğŸ¯ ××™××•×Ÿ ×œ××™×“×ª ×›×¤×œ</h2>
                    <p>×‘×•××• × ×‘×™×Ÿ ××ª ×”×›×¤×œ ×‘×××¦×¢×•×ª ×ª××•× ×•×ª!</p>
                </div>

                <div class="lab-problem" id="labProblem">9 Ã— 6</div>

                <div class="lab-controls" style="display: none;">
                    <button class="hint-btn" onclick="showHint()">ğŸ’¡ ×”×¦×’ ×œ×™ ×¨××– ×—×–×•×ª×™</button>
                    <button class="hint-btn" style="background: #667eea;" onclick="clearVisualization()">ğŸ—‘ï¸ × ×§×”</button>
                </div>

                <div class="answer-area">
                    <div id="labVisualization" class="visualization"></div>
                    <div class="counter-display" id="counterDisplay" style="display:none;">
                        <p>××” ×”×ª×©×•×‘×”?</p>
                        <div class="count-buttons" id="answerButtons">
                            <!-- ×”×›×¤×ª×•×¨×™× ×™×•×¤×§×“×• ×“×™× ××™×ª ×‘-JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="feedback" id="labFeedback" dir="ltr"></div>

                <div class="nav-buttons">
                    <button class="next-btn" id="labNextBtn" onclick="nextLabQuestion()" style="display:none;">×©××œ×” ×”×‘××” âœ</button>
                    <button class="back-lab-btn" onclick="backToMenu()">ğŸ”™ ×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× =====
        let gameMode = 'lab'; // single, lab or two
        let difficulty = 'easy'; // easy, medium, hard
        let maxNum = 5; // based on difficulty
        
        let allQuestions = [];
        let currentQuestionIndex = 0;
        let currentQuestion = null;
        let answers = [];
        
        let startTime = null;
        let timerInterval = null;
        let elapsedSeconds = 0;
        
        let correctCount = 0;
        let wrongCount = 0;
        let penaltySeconds = 0;
        
        // ××©×ª× ×™× ×œ××¦×‘ ×©× ×™ ×©×—×§× ×™×
        let currentPlayer = 1;
        let player1Data = {
            time: 0,
            correct: 0,
            wrong: 0,
            penalty: 0,
            finished: false
        };
        let player2Data = {
            time: 0,
            correct: 0,
            wrong: 0,
            penalty: 0,
            finished: false
        };

        // ××©×ª× ×™× ×œ××¢×‘×“×ª ×”×›×¤×œ
        let labQuestions = [];
        let labCurrentIndex = 0;
        let labCurrentQuestion = null;
        let labCurrentCount = 0;
        let labHintShown = false;

        // ===== ××™×¨×•×¢×™× ×‘×ª×¤×¨×™×˜ ×¨××©×™ =====
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                gameMode = this.dataset.mode;
                
                // ×”×¡×ª×¨/×”×¦×’ ××ª ×‘×—×™×¨×ª ×”×¨××” ×œ×¤×™ ×”××¦×‘
                const difficultySelector = document.querySelector('.difficulty-selector');
                if (gameMode === 'lab') {
                    difficultySelector.style.display = 'none';
                } else {
                    difficultySelector.style.display = 'block';
                }
            });
        });

        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                difficulty = this.dataset.difficulty;
                
                if (difficulty === 'easy') maxNum = 5;
                else if (difficulty === 'medium') maxNum = 10;
                else if (difficulty === 'hard') maxNum = 12;
            });
        });

        document.getElementById('startBtn').addEventListener('click', startGame);

        // ===== ×”×¤×¢×œ×ª ××©×—×§ =====
        function startGame() {
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('finishScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('labScreen').style.display = 'none';

            // ×× ×–×” ××¦×‘ ××¢×‘×“×ª ×”×›×¤×œ
            if (gameMode === 'lab') {
                document.getElementById('gameScreen').style.display = 'none';
                document.getElementById('labScreen').style.display = 'block';
                startLabMode();
                return;
            }

            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ×—×œ×§ ×”××©×—×§
            setTimeout(() => {
                document.querySelector('.game-screen').scrollIntoView({ behavior: 'smooth' });
            }, 100);

            // ×¢×“×›×•×Ÿ ×©× ××©×—×§
            if (gameMode === 'single') {
                document.getElementById('gameTitle').textContent = 'ğŸ® ×©×—×§×Ÿ ×™×—×™×“ - ××¨×•×¥ ×”×›×¤×œ';
                document.getElementById('playersContainer').style.display = 'none';
            } else {
                document.getElementById('gameTitle').textContent = 'ğŸ‘¥ ×©× ×™ ×©×—×§× ×™× - ×ª×—×¨×•×ª ×–××Ÿ';
                document.getElementById('playersContainer').style.display = 'flex';
                updatePlayerCards();
            }

            // ×™×¦×™×¨×ª ×©××œ×•×ª
            generateAllQuestions();
            document.getElementById('totalQuestions').textContent = allQuestions.length;
            
            // ××™×ª×—×•×œ
            currentQuestionIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            penaltySeconds = 0;
            player1Data = { time: 0, correct: 0, wrong: 0, penalty: 0, finished: false };
            player2Data = { time: 0, correct: 0, wrong: 0, penalty: 0, finished: false };
            currentPlayer = 1;
            
            startTime = Date.now();
            elapsedSeconds = 0;
            startTimer();
            
            renderMultiplicationTable();
            showQuestion();
        }

        // ===== ×™×¦×™×¨×ª ×›×œ ×”×©××œ×•×ª ×‘×¡×“×¨ ×©×™×˜×ª×™ =====
        function generateAllQuestions() {
            allQuestions = [];
            
            let minRange = 0;
            let maxRange = 5;
            let maxMultiplier = 10;
            
            if (difficulty === 'easy') {
                minRange = 0;
                maxRange = 5;
                maxMultiplier = 10;
            } else if (difficulty === 'medium') {
                minRange = 6;
                maxRange = 10;
                maxMultiplier = 10;
            } else if (difficulty === 'hard') {
                minRange = 10;
                maxRange = 12;
                maxMultiplier = 12;
            }
            
            // ×œ×›×œ ××¡×¤×¨ ×‘×˜×•×•×—, ×›×¤×•×œ ×‘×›×œ 0 ×¢×“ maxMultiplier
            for (let i = minRange; i <= maxRange; i++) {
                for (let j = 0; j <= maxMultiplier; j++) {
                    allQuestions.push({ a: i, b: j });
                }
            }
        }

        // ===== ×˜×™×™××¨ =====
        function startTimer() {
            timerInterval = setInterval(() => {
                elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                updateTimerDisplay();
            }, 100);
        }

        function updateTimerDisplay() {
            const totalSeconds = elapsedSeconds + penaltySeconds;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            document.getElementById('timer').textContent = 
                String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
            
            if (gameMode === 'two' && currentPlayer === 1) {
                document.getElementById('player1Time').textContent = document.getElementById('timer').textContent;
            }
        }

        // ===== ×˜×‘×œ×ª ×›×¤×œ =====
        function renderMultiplicationTable() {
            const table = document.getElementById('multiplicationTable');
            table.innerHTML = '';
            
            let minRange = 0;
            let maxRange = 5;
            let maxMultiplier = 10;
            
            if (difficulty === 'easy') {
                minRange = 0;
                maxRange = 5;
                maxMultiplier = 10;
            } else if (difficulty === 'medium') {
                minRange = 6;
                maxRange = 10;
                maxMultiplier = 10;
            } else if (difficulty === 'hard') {
                minRange = 10;
                maxRange = 12;
                maxMultiplier = 12;
            }
            
            // ×©×•×¨×•×ª = ×˜×•×•×— ×”×¨××”, ×¢××•×“×•×ª = 0 ×¢×“ maxMultiplier
            for (let i = minRange; i <= maxRange; i++) {
                for (let j = 0; j <= maxMultiplier; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'table-cell';
                    cell.textContent = `${i}Ã—${j}`;
                    cell.dir = 'ltr';
                    
                    // ×¡×™××•×Ÿ ×”×ª× ×”× ×•×›×—×™
                    if (currentQuestion && currentQuestion.a === i && currentQuestion.b === j) {
                        cell.classList.add('current');
                    }
                    
                    table.appendChild(cell);
                }
            }
        }

        // ===== ×”×¦×’×ª ×©××œ×” =====
        function showQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                finishGame();
                return;
            }

            currentQuestion = allQuestions[currentQuestionIndex];
            const correct = currentQuestion.a * currentQuestion.b;
            
            // ×™×¦×™×¨×ª ×ª×©×•×‘×•×ª
            answers = [correct];
            
            // ×”×•×¡×¤×ª ×©×ª×™ ×ª×©×•×‘×•×ª ×©×’×•×™×•×ª
            while (answers.length < 3) {
                const wrong = Math.floor(Math.random() * (maxNum * maxNum)) + 1;
                if (!answers.includes(wrong)) {
                    answers.push(wrong);
                }
            }
            
            // ×¢×¨×‘×•×œ ×”×ª×©×•×‘×•×ª
            answers.sort(() => Math.random() - 0.5);
            
            // ×”×¦×’×”
            document.getElementById('question').textContent = 
                `${currentQuestion.a} Ã— ${currentQuestion.b} = ?`;
            document.getElementById('questionNum').textContent = currentQuestionIndex + 1;
            document.getElementById('penaltyDisplay').textContent = 
                penaltySeconds > 0 ? `âš ï¸ ×¢×•× ×©: +${penaltySeconds}s` : '';
            
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';
            
            answers.forEach(answer => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.addEventListener('click', () => selectAnswer(answer, correct));
                answersContainer.appendChild(btn);
            });
            
            renderMultiplicationTable();
        }

        // ===== ×‘×—×™×¨×ª ×ª×©×•×‘×” =====
        function selectAnswer(selected, correct) {
            const answersContainer = document.getElementById('answersContainer');
            const buttons = answersContainer.querySelectorAll('.answer-btn');
            
            buttons.forEach(btn => btn.disabled = true);
            
            if (selected === correct) {
                // ×ª×©×•×‘×” × ×›×•× ×”
                correctCount++;
                if (gameMode === 'two') {
                    if (currentPlayer === 1) player1Data.correct++;
                    else player2Data.correct++;
                }
                
                // ×¡×™××•×Ÿ ×”×›×¤×ª×•×¨ ×”× ×›×•×Ÿ
                buttons.forEach(btn => {
                    if (parseInt(btn.textContent) === correct) {
                        btn.classList.add('correct');
                    }
                });
                
                playSound('correct');
                
                setTimeout(() => {
                    currentQuestionIndex++;
                    showQuestion();
                }, 800);
                
            } else {
                // ×ª×©×•×‘×” ×©×’×•×™×”
                wrongCount++;
                penaltySeconds += 3;
                if (gameMode === 'two') {
                    if (currentPlayer === 1) {
                        player1Data.wrong++;
                        player1Data.penalty += 3;
                    } else {
                        player2Data.wrong++;
                        player2Data.penalty += 3;
                    }
                }
                
                // ×¡×™××•×Ÿ ×”×ª×©×•×‘×” ×”×©×’×•×™×”
                buttons.forEach(btn => {
                    if (parseInt(btn.textContent) === selected) {
                        btn.classList.add('wrong');
                    }
                });
                
                playSound('wrong');
                
                // ×”××ª×Ÿ ××‘×œ ××œ ×ª×¢×‘×•×¨ ×œ×©××œ×” ×”×‘××” ×¢×“ ×©×œ× ×™×‘×—×¨ ×‘× ×›×•×Ÿ
                setTimeout(() => {
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('wrong');
                    });
                }, 1000);
            }
            
            document.getElementById('correctCount').textContent = correctCount;
        }

        // ===== ×¡×™×•× ××©×—×§ =====
        function finishGame() {
            clearInterval(timerInterval);
            
            if (gameMode === 'single') {
                showFinishScreen();
            } else {
                if (currentPlayer === 1) {
                    player1Data.time = elapsedSeconds;
                    player1Data.penalty = penaltySeconds;
                    player1Data.correct = correctCount;
                    player1Data.wrong = wrongCount;
                    player1Data.finished = true;
                    
                    // ×”×¦×’×ª ××¡×š ×”×¤×¡×§×”
                    showPauseScreen();
                    
                } else {
                    player2Data.time = elapsedSeconds;
                    player2Data.penalty = penaltySeconds;
                    player2Data.correct = correctCount;
                    player2Data.wrong = wrongCount;
                    player2Data.finished = true;
                    
                    showResultsScreen();
                }
            }
        }

        // ===== ××¡×š ×”×¤×¡×§×” ×‘×™×Ÿ ×©×—×§× ×™× =====
        function showPauseScreen() {
            document.getElementById('pauseScreen').classList.remove('hidden');
            document.getElementById('nextPlayerName').textContent = '×©×—×§×Ÿ 2';
            
            let countdown = 3;
            document.getElementById('countdown').textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    document.getElementById('countdown').textContent = countdown;
                } else {
                    clearInterval(countdownInterval);
                    
                    // ×”×ª×—×œ×ª ××©×—×§ ×©×—×§×Ÿ 2
                    document.getElementById('pauseScreen').classList.add('hidden');
                    
                    currentPlayer = 2;
                    currentQuestionIndex = 0;
                    correctCount = 0;
                    wrongCount = 0;
                    penaltySeconds = 0;
                    startTime = Date.now();
                    elapsedSeconds = 0;
                    
                    startTimer();
                    updatePlayerCards();
                    showQuestion();
                }
            }, 1000);
        }

        // ===== ×¢×“×›×•×Ÿ ×›×¨×˜×™×¡×™ ×©×—×§× ×™× =====
        function updatePlayerCards() {
            if (currentPlayer === 1) {
                document.getElementById('player1Status').textContent = '×‘×ª×•×š';
                document.getElementById('player2Status').textContent = '××—×›×”...';
            } else {
                document.getElementById('player1Status').textContent = '×¡×™×™×! âœ“';
                document.getElementById('player2Status').textContent = '×‘×ª×•×š';
            }
        }

        // ===== ××¡×š ×¡×™×•× (×©×—×§×Ÿ ×™×—×™×“) =====
        function showFinishScreen() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('finishScreen').style.display = 'block';
            
            // ×× ×™××¦×™×™×ª ×§×•× ×¤×˜×™
            createConfetti();
            
            document.getElementById('finalTime').textContent = formatTime(elapsedSeconds + penaltySeconds);
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalWrong').textContent = wrongCount;
            document.getElementById('finalPenalty').textContent = penaltySeconds;
            
            if (penaltySeconds > 0) {
                document.getElementById('penaltyNotice').textContent = 
                    `âš ï¸ ×”×•×¡×¤×• ${penaltySeconds} ×©× ×™×•×ª ×¢×•× ×© ×¢×‘×•×¨ ${wrongCount} ×©×’×™××•×ª (3 ×©× ×™×•×ª ×œ×›×œ ×©×’×™××”)`;
                document.getElementById('penaltyNotice').classList.remove('hidden');
            }
        }

        // ===== ×× ×™××¦×™×™×ª ×§×•× ×¤×˜×™ =====
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#ffeb3b', '#4caf50'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3500);
            }
        }

        // ===== ××¡×š ×ª×•×¦××•×ª (×©× ×™ ×©×—×§× ×™×) =====
        function showResultsScreen() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            // ×× ×™××¦×™×™×ª ×§×•× ×¤×˜×™
            createConfetti();
            
            // ×©×—×§×Ÿ 1
            document.getElementById('p1ResultTime').textContent = formatTime(player1Data.time + player1Data.penalty);
            document.getElementById('p1ResultCorrect').textContent = player1Data.correct;
            document.getElementById('p1ResultWrong').textContent = player1Data.wrong;
            document.getElementById('p1ResultPenalty').textContent = player1Data.penalty + 's';
            
            // ×©×—×§×Ÿ 2
            document.getElementById('p2ResultTime').textContent = formatTime(player2Data.time + player2Data.penalty);
            document.getElementById('p2ResultCorrect').textContent = player2Data.correct;
            document.getElementById('p2ResultWrong').textContent = player2Data.wrong;
            document.getElementById('p2ResultPenalty').textContent = player2Data.penalty + 's';
            
            // ×§×‘×™×¢×ª ×× ×¦×—
            const finalTime1 = player1Data.time + player1Data.penalty;
            const finalTime2 = player2Data.time + player2Data.penalty;
            
            let resultTitle = '';
            if (finalTime1 < finalTime2) {
                resultTitle = 'ğŸ† ×©×—×§×Ÿ 1 × ×™×¦×—!';
            } else if (finalTime2 < finalTime1) {
                resultTitle = 'ğŸ† ×©×—×§×Ÿ 2 × ×™×¦×—!';
            } else {
                resultTitle = 'ğŸ¤ ×ª×™×§×•!';
            }
            
            document.getElementById('resultTitle').textContent = resultTitle;
            
            // ×”×•×“×¢×” ×¢×œ ×¢×•× ×©
            if (player1Data.penalty > 0 || player2Data.penalty > 0) {
                let penaltyText = '×¢×•× ×©×™× ×©×”×•×˜×œ×•: ';
                if (player1Data.penalty > 0) {
                    penaltyText += `×©×—×§×Ÿ 1: +${player1Data.penalty}s (${player1Data.wrong} ×©×’×™××•×ª)`;
                }
                if (player2Data.penalty > 0) {
                    if (player1Data.penalty > 0) penaltyText += ' | ';
                    penaltyText += `×©×—×§×Ÿ 2: +${player2Data.penalty}s (${player2Data.wrong} ×©×’×™××•×ª)`;
                }
                document.getElementById('resultPenaltyNotice').textContent = 'âš ï¸ ' + penaltyText;
                document.getElementById('resultPenaltyNotice').classList.remove('hidden');
            }
        }

        // ===== ×›×¤×ª×•×¨×™× =====
        document.getElementById('playAgainBtn').addEventListener('click', () => {
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('finishScreen').style.display = 'none';
        });

        document.getElementById('backToMenuBtn').addEventListener('click', () => {
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('finishScreen').style.display = 'none';
        });

        document.getElementById('playAgain2Btn').addEventListener('click', () => {
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('resultsScreen').style.display = 'none';
        });

        document.getElementById('backToMenu2Btn').addEventListener('click', () => {
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('resultsScreen').style.display = 'none';
        });

        // ===== ×œ×—×¦×Ÿ ×—×–×¨×” ××”××©×—×§ =====
        document.getElementById('backFromGameBtn').addEventListener('click', () => {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('gameScreen').style.display = 'none';
            document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
        });

        // ===== ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ =====
        
        // ===== ×¤×•× ×§×¦×™×•×ª ××¢×‘×“×ª ×”×›×¤×œ =====
        function startLabMode() {
            // ×™×¦×™×¨×ª ×œ×•×— ×”×›×¤×œ ×-1Ã—1 ×¢×“ 10Ã—10
            labQuestions = [];
            
            for (let a = 1; a <= 10; a++) {
                for (let b = 1; b <= 10; b++) {
                    labQuestions.push({ a, b, answer: a * b });
                }
            }
            
            labCurrentIndex = 0;
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
            setTimeout(() => {
                document.getElementById('labScreen').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
            
            showLabQuestion();
        }

        function showLabQuestion() {
            if (labCurrentIndex >= labQuestions.length) {
                showLabFinish();
                return;
            }
            
            labCurrentQuestion = labQuestions[labCurrentIndex];
            labCurrentCount = 0;
            labHintShown = false;
            
            const totalQuestions = labQuestions.length;
            const currentNum = labCurrentIndex + 1;
            
            // ×”×¦×’ ×”×ª×¨×’×™×œ ×‘×’×•×“×œ ×’×“×•×œ ×¢× LTR
            const problemHTML = `<div style="width: 100%; text-align: center; direction: ltr;">
                <div style="font-size: 3.5em; font-weight: bold; color: white; margin-bottom: 10px;">${labCurrentQuestion.a} Ã— ${labCurrentQuestion.b}</div>
                <div style="font-size: 0.8em; color: rgba(255,255,255,0.8);">×©××œ×” ${currentNum} ××ª×•×š ${totalQuestions}</div>
            </div>`;
            
            document.getElementById('labProblem').innerHTML = problemHTML;
            document.getElementById('labVisualization').innerHTML = '';
            document.getElementById('counterDisplay').style.display = 'block';
            document.getElementById('labFeedback').innerHTML = '';
            document.getElementById('labFeedback').className = 'feedback';
            document.getElementById('labNextBtn').style.display = 'none';
            
            // ×™×¦×•×¨ 3 ××¤×©×¨×•×™×•×ª ×ª×©×•×‘×”
            generateAnswerOptions();
            
            // ×”×¦×’ ××ª ×”×¨××– ×”×—×–×•×ª×™ ××•×˜×•××˜×™×ª
            showHint();
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
            setTimeout(() => {
                document.getElementById('labScreen').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function generateAnswerOptions() {
            const correctAnswer = labCurrentQuestion.answer;
            const options = [correctAnswer];
            
            // ×™×¦×•×¨ 2 ×ª×©×•×‘×•×ª ×©×’×•×™×•×ª
            while (options.length < 3) {
                let wrongAnswer;
                if (correctAnswer === 0) {
                    wrongAnswer = Math.floor(Math.random() * 5) + 1;
                } else {
                    // ×ª×©×•×‘×” ×©×’×•×™×” ×‘×˜×•×•×— ×©×œ Â±20% ××”×ª×©×•×‘×” ×”× ×›×•× ×”
                    const variance = Math.max(1, Math.floor(correctAnswer * 0.2));
                    wrongAnswer = correctAnswer + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * variance) + 1);
                    if (wrongAnswer < 0) wrongAnswer = Math.abs(wrongAnswer);
                    if (wrongAnswer === correctAnswer) continue;
                }
                
                if (!options.includes(wrongAnswer)) {
                    options.push(wrongAnswer);
                }
            }
            
            // ×¢×¨×‘×‘ ××ª ×”×ª×©×•×‘×•×ª
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            // ×”×¦×’ ××ª ×”×›×¤×ª×•×¨×™×
            const buttonsContainer = document.getElementById('answerButtons');
            if (!buttonsContainer) {
                console.error('answerButtons element not found');
                return;
            }
            
            buttonsContainer.innerHTML = '';
            
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'count-btn';
                btn.textContent = option;
                btn.onclick = () => checkLabAnswer(option);
                buttonsContainer.appendChild(btn);
            });
        }

        function checkLabAnswer(selectedAnswer) {
            const feedback = document.getElementById('labFeedback');
            const correctAnswer = labCurrentQuestion.answer;
            
            if (selectedAnswer === correctAnswer) {
                // ×‘× ×” ××ª ×”×˜×§×¡×˜ ×¢× ×¡×“×¨ LTR ××¤×•×¨×©
                const equation = `${labCurrentQuestion.a} Ã— ${labCurrentQuestion.b} = ${correctAnswer}`;
                feedback.innerHTML = `<div style="unicode-bidi: bidi-override; direction: ltr;">âœ“ ${equation}</div>`;
                feedback.className = 'feedback correct';
                
                // ×”×¦×’ ×›×¤×ª×•×¨ ×”×©××œ×” ×”×‘××”
                document.getElementById('labNextBtn').style.display = 'inline-block';
                
                // ×›×‘×” ××ª ×›×¤×ª×•×¨×™ ×”×ª×©×•×‘×”
                document.querySelectorAll('#answerButtons button').forEach(btn => btn.disabled = true);
                
                // ×¦×œ×™×œ ×”×¦×œ×—×”
                playSound('correct');
            } else {
                const equation = `${labCurrentQuestion.a} Ã— ${labCurrentQuestion.b} = ${correctAnswer}`;
                feedback.innerHTML = `<div style="unicode-bidi: bidi-override; direction: ltr;">âœ— ${equation}</div>`;
                feedback.className = 'feedback incorrect';
                
                // ×¦×œ×™×œ ×©×’×™××”
                playSound('wrong');
            }
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ××˜×” ×›×“×™ ×œ×¨××•×ª ××ª ×”×¤×™×“×‘×§
            setTimeout(() => {
                document.getElementById('labFeedback').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function showHint() {
            if (!labCurrentQuestion) return;
            
            labHintShown = true;
            const a = labCurrentQuestion.a;
            const b = labCurrentQuestion.b;
            const visualization = document.getElementById('labVisualization');
            
            // × ×§×” ×§×•×“×
            visualization.innerHTML = '';
            
            // ×× ×”××¡×¤×¨×™× ×§×˜× ×™× ××“×™ ××• ×’×“×•×œ×™× ××“×™, ×”×¦×’ ×‘×¦×•×¨×” ×©×•× ×”
            if (a > 10 || b > 10) {
                // ×¢×‘×•×¨ ×ª×¨×’×™×œ×™× ×’×“×•×œ×™×, ×”×¦×’ ×¨××– ××™×œ×•×œ×™
                visualization.innerHTML = `
                    <div style="text-align: center; padding: 20px; font-size: 1.2em; color: #667eea;">
                        <p>×–×” ×”×¨×‘×” ××“×™ ×œ×¡×¤×•×¨! ğŸ˜…</p>
                        <p style="margin-top: 15px; font-size: 1em; color: #666;">
                            ×™×© ×œ× ×• <strong>${a}</strong> ×§×‘×•×¦×•×ª ×©×œ <strong>${b}</strong><br>
                            ××• <strong>${b}</strong> ×§×‘×•×¦×•×ª ×©×œ <strong>${a}</strong>
                        </p>
                        <p style="margin-top: 15px; font-size: 0.95em; color: #999;">
                            ××ª×” ×™×›×•×œ ×œ×”×©×ª××© ×‘×—×™×©×•×‘ ××• ×‘× ×™×™×¨ ×•×¢×™×¤×¨×•×Ÿ!
                        </p>
                    </div>
                `;
            } else {
                // ×”×•×¡×£ ×”×¡×‘×¨ ××™×œ×•×œ×™
                const explanation = document.createElement('div');
                explanation.style.cssText = `
                    text-align: center;
                    margin-bottom: 20px;
                    font-size: 1.2em;
                    color: #667eea;
                    font-weight: bold;
                `;
                
                // ×ª×™×§×•×Ÿ ×’×¨××˜×™ - ×§×‘×•×¦×”/×§×‘×•×¦×•×ª
                let explanationText;
                if (a === 1) {
                    explanationText = `×§×‘×•×¦×” ××—×ª ×©×œ ${b} × ×§×•×“×•×ª`;
                } else {
                    explanationText = `${a} ×§×‘×•×¦×•×ª ×©×œ ${b} × ×§×•×“×•×ª`;
                }
                explanation.innerHTML = explanationText;
                visualization.appendChild(explanation);
                
                // ×™×¦×•×¨ 'a' ×¢×™×’×•×œ×™× ×’×“×•×œ×™× ×›×—×•×œ×™× ×¢× 'b' × ×§×•×“×•×ª ×œ×‘× ×•×ª ×‘×ª×•×š ×›×œ ××—×“
                const circlesContainer = document.createElement('div');
                circlesContainer.style.cssText = `
                    display: flex;
                    justify-content: center;
                    gap: 30px;
                    flex-wrap: wrap;
                    align-items: center;
                    width: 100%;
                    margin: 0 auto;
                `;
                
                for (let i = 0; i < a; i++) {
                    // ×™×¦×•×¨ ×¢×™×’×•×œ ×’×“×•×œ ×›×—×•×œ
                    const circle = document.createElement('div');
                    circle.style.cssText = `
                        width: 150px;
                        height: 150px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        flex-wrap: wrap;
                        align-content: center;
                        justify-content: center;
                        gap: 10px;
                        padding: 15px;
                        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
                        animation: pop-in 0.5s ease-out;
                        animation-delay: ${i * 0.2}s;
                        flex-shrink: 0;
                    `;
                    
                    // ×”×•×¡×£ 'b' × ×§×•×“×•×ª ×œ×‘× ×•×ª ××¡×•×“×¨×•×ª
                    const dotsPerRow = Math.ceil(Math.sqrt(b));
                    for (let j = 0; j < b; j++) {
                        const dot = document.createElement('div');
                        dot.style.cssText = `
                            width: 12px;
                            height: 12px;
                            border-radius: 50%;
                            background: white;
                            animation: pop-in 0.3s ease-out;
                            animation-delay: ${i * 0.2 + j * 0.05}s;
                        `;
                        circle.appendChild(dot);
                    }
                    
                    circlesContainer.appendChild(circle);
                }
                
                visualization.appendChild(circlesContainer);
            }
            
            // ×”×¦×’ ××ª ××–×•×¨ ×”×¡×¤×™×¨×”
            document.getElementById('counterDisplay').style.display = 'block';
            labCurrentCount = 0;
        }

        function clearVisualization() {
            document.getElementById('labVisualization').innerHTML = '';
            document.getElementById('counterDisplay').style.display = 'none';
            document.getElementById('labFeedback').innerHTML = '';
            labHintShown = false;
        }

        function incrementCount() {
            // ×¤×•× ×§×¦×™×” ×–×• ×›×‘×¨ ×œ× ×‘×©×™××•×©
        }

        function decrementCount() {
            // ×¤×•× ×§×¦×™×” ×–×• ×›×‘×¨ ×œ× ×‘×©×™××•×©
        }

        function nextLabQuestion() {
            labCurrentIndex++;
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
            setTimeout(() => {
                document.getElementById('labScreen').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
            
            showLabQuestion();
        }

        function showLabFinish() {
            document.getElementById('labScreen').style.display = 'none';
            
            // ×”×¦×’ ××¡×š ×©×œ ×¡×™×•×
            const finishHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h1 style="color: #667eea; font-size: 2.5em; margin-bottom: 20px;">ğŸ‰ ×›×œ ×”×›×‘×•×“!</h1>
                    <p style="font-size: 1.3em; color: #666; margin-bottom: 15px;">×¡×™×™××ª ××ª ×›×œ 100 ×©××œ×•×ª ×©×œ ×œ×•×— ×”×›×¤×œ!</p>
                    <p style="font-size: 1.1em; color: #999; margin-bottom: 40px;">×œ××“×ª ××ª ×›×œ ×”×›×¤×œ ×-1Ã—1 ×¢×“ 10Ã—10!</p>
                    <button class="back-lab-btn" onclick="location.reload()" style="padding: 15px 40px; font-size: 1.2em; background: #667eea; color: white; border: none;">ğŸ”™ ×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
                </div>
            `;
            
            document.getElementById('finishScreen').innerHTML = finishHTML;
            document.getElementById('finishScreen').style.display = 'block';
            
            // ×× ×™××¦×™×™×ª ×§×•× ×¤×˜×™
            createConfetti();
        }

        function backToMenu() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('labScreen').style.display = 'none';
            document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
        }

        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                // ×¦×œ×™×œ × ×¢×™× ×™×•×ª×¨ - ×× ×’×™× ×” ×¢×•×œ×”
                const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                notes.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                    osc.start(audioContext.currentTime + i * 0.1);
                    osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
                });
            } else if (type === 'wrong') {
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(250, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            }
        }
    </script>
</body>
</html>
